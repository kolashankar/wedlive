"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2645],{2645:function(e,l,a){a.d(l,{Z:function(){return b}});var t=a(57437),s=a(2265),i=a(10273),r=a(56360),o=a(79004),n=a(68639),c=a(3274),d=a(18604),m=a(68954),u=a(98094),h=a(9229),x=a(75733),f=a(74697),g=a(24241),p=a(23787),y=a(37164),j=a(27776),v=a(6657),_=a(67159);function b(e){var l,a;let{weddingId:b,isCreator:N=!1}=e,[w,L]=(0,s.useState)([]),[A,E]=(0,s.useState)(!0),[Z,D]=(0,s.useState)(null),[I,M]=(0,s.useState)("all");(0,s.useEffect)(()=>{b&&Y()},[b]);let Y=async()=>{try{E(!0),console.log("[MEDIA_GALLERY] Loading media for wedding:",b);let e=await v.default.get("/api/media/gallery/".concat(b,"?include_urls=true"));if(console.log("[MEDIA_GALLERY] API response:",e),console.log("[MEDIA_GALLERY] Media data:",e.data),!e.data){console.error("[MEDIA_GALLERY] No media data received:",e),j.toast.error("No media data received"),L([]);return}let l=Array.isArray(e.data)?e.data:e.data.media||[];if(console.log("[MEDIA_GALLERY] Processed media items:",l),!Array.isArray(l)){console.error("[MEDIA_GALLERY] Invalid media data format:",e.data),j.toast.error("Invalid media data format"),L([]);return}let a=l.filter(e=>!!e.file_url&&(!(e.file_url.includes("/file_")&&/\/file_\d+/.test(e.file_url))||(console.warn("[MEDIA_GALLERY] Filtering out item with placeholder file_id:",e),!1)));if(a.length<l.length){let e=l.length-a.length;console.log("[MEDIA_GALLERY] Filtered out ".concat(e," items with placeholder/invalid file references")),j.toast.info("Note: ".concat(e," placeholder image(s) were filtered out. Please upload actual photos."),{duration:5e3})}a.forEach((e,l)=>{if(console.log("[MEDIA_GALLERY] Original media item ".concat(l,":"),{id:e.id,original_file_url:e.file_url,media_type:e.media_type}),e.file_url){if(e.file_url.startsWith("http://")||e.file_url.startsWith("https://"))console.log("[MEDIA_GALLERY] Keeping original URL (could be Telegram):",e.file_url);else{let l=v.default.defaults.baseURL;console.log("[MEDIA_GALLERY] API Base URL:",l);let a=e.file_url.startsWith("/api/")?e.file_url:"/api".concat(e.file_url),t="".concat(l).concat(a);console.log("[MEDIA_GALLERY] URL transformation:",{original:e.file_url,normalized:a,final:t}),e.file_url=t}}console.log("[MEDIA_GALLERY] Processed media item ".concat(l,":"),{id:e.id,final_file_url:e.file_url,media_type:e.media_type})}),console.log("[MEDIA_GALLERY] Setting ".concat(a.length," valid media items")),L(a)}catch(t){var e,l;console.error("[MEDIA_GALLERY] Error loading media:",t);let a=(null===(l=t.response)||void 0===l?void 0:null===(e=l.data)||void 0===e?void 0:e.detail)||t.message||"Failed to load media gallery";j.toast.error(a),L([])}finally{E(!1)}},R=async e=>{if(window.confirm("Are you sure you want to delete this media?"))try{await v.default.delete("/api/media/media/".concat(e)),L(w.filter(l=>l.id!==e)),D(null),j.toast.success("Media deleted successfully")}catch(e){console.error("Error deleting media:",e),j.toast.error("Failed to delete media")}},G=w.filter(e=>"all"===I||("video"===I?"video"===e.media_type||"youtube_video"===e.media_type:e.media_type===I)),k=w.filter(e=>"photo"===e.media_type).length,S=w.filter(e=>"video"===e.media_type||"youtube_video"===e.media_type).length;return A?(0,t.jsx)(i.Zb,{children:(0,t.jsx)(i.aY,{className:"py-12",children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(c.Z,{className:"w-8 h-8 animate-spin text-rose-500"})})})}):0===w.length?(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center",children:[(0,t.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),"Media Gallery"]})}),(0,t.jsx)(i.aY,{children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 bg-rose-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"w-10 h-10 text-rose-500"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No media yet"}),(0,t.jsx)("p",{className:"text-gray-600",children:N?"Upload photos and videos to share memories of this special day":"Check back later for photos and videos from this wedding"})]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(i.ll,{className:"flex items-center",children:[(0,t.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),"Media Gallery"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(o.C,{variant:"all"===I?"default":"outline",className:"cursor-pointer ".concat("all"===I?"bg-rose-500":""),onClick:()=>M("all"),children:["All (",w.length,")"]}),(0,t.jsxs)(o.C,{variant:"photo"===I?"default":"outline",className:"cursor-pointer ".concat("photo"===I?"bg-rose-500":""),onClick:()=>M("photo"),children:[(0,t.jsx)(d.Z,{className:"w-3 h-3 mr-1"}),"Photos (",k,")"]}),(0,t.jsxs)(o.C,{variant:"video"===I?"default":"outline",className:"cursor-pointer ".concat("video"===I?"bg-rose-500":""),onClick:()=>M("video"),children:[(0,t.jsx)(m.Z,{className:"w-3 h-3 mr-1"}),"Videos (",S,")"]})]})]})}),(0,t.jsx)(i.aY,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:G.map(e=>(0,t.jsx)("div",{className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer group bg-gray-100",onClick:()=>D(e),children:"photo"===e.media_type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:e.file_url,alt:e.caption||"Wedding photo",className:"w-full h-full object-cover transition-transform group-hover:scale-110",loading:"lazy",onError:l=>{console.error("[MEDIA_GALLERY] Image failed to load:",e.file_url,l),e.file_url&&e.file_url.includes("/file_")&&/\/file_\d+/.test(e.file_url)&&console.warn("[MEDIA_GALLERY] Detected placeholder image reference:",e.file_url),l.target.style.display="none",l.target.nextSibling.style.display="flex"},onLoad:l=>{console.log("[MEDIA_GALLERY] Image loaded successfully:",e.file_url),l.target.nextSibling.style.display="none"}}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center",style:{display:"none"},children:(0,t.jsxs)("div",{className:"text-center p-4",children:[(0,t.jsx)(d.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Failed to load"}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Photo unavailable"})]})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}):"youtube_video"===e.media_type?(0,t.jsxs)(t.Fragment,{children:[e.thumbnail_url?(0,t.jsx)("img",{src:e.thumbnail_url,alt:e.title||"YouTube Live Stream",className:"w-full h-full object-cover transition-transform group-hover:scale-110",loading:"lazy"}):(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500 to-rose-600 opacity-20"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-red-600/90 rounded-full p-4",children:(0,t.jsx)(u.Z,{className:"w-8 h-8 text-white",fill:"white"})})}),(0,t.jsx)("div",{className:"absolute top-2 right-2",children:(0,t.jsxs)(o.C,{className:"bg-red-600 text-white",children:[(0,t.jsx)(h.Z,{className:"w-3 h-3 mr-1"}),"YouTube"]})}),e.view_count>0&&(0,t.jsx)("div",{className:"absolute bottom-2 left-2",children:(0,t.jsxs)(o.C,{variant:"secondary",className:"bg-black/60 text-white",children:[(0,t.jsx)(x.Z,{className:"w-3 h-3 mr-1"}),e.view_count.toLocaleString()]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500 to-rose-500 opacity-20"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-black/60 rounded-full p-4",children:(0,t.jsx)(u.Z,{className:"w-8 h-8 text-white",fill:"white"})})}),(0,t.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,t.jsxs)(o.C,{variant:"secondary",className:"bg-black/60 text-white",children:[(0,t.jsx)(m.Z,{className:"w-3 h-3 mr-1"}),e.duration?"".concat(Math.floor(e.duration/60),":").concat((e.duration%60).toString().padStart(2,"0")):"Video"]})})]})},e.id))})})]}),(0,t.jsx)(n.Vq,{open:null!==Z,onOpenChange:e=>!e&&D(null),children:(0,t.jsx)(n.cZ,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:Z&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.fK,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.$N,{className:"flex items-center",children:["photo"===Z.media_type?(0,t.jsx)(d.Z,{className:"w-5 h-5 mr-2"}):"youtube_video"===Z.media_type?(0,t.jsx)(h.Z,{className:"w-5 h-5 mr-2 text-red-600"}):(0,t.jsx)(m.Z,{className:"w-5 h-5 mr-2"}),Z.title||Z.caption||"Media"]}),N&&(0,t.jsxs)(r.z,{variant:"destructive",size:"sm",onClick:()=>R(Z.id),children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:"photo"===Z.media_type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:Z.file_url,alt:Z.caption||"Wedding photo",className:"w-full h-auto max-h-[60vh] object-contain mx-auto",onError:e=>{console.error("Dialog image failed to load:",Z.file_url),e.target.style.display="none",e.target.nextSibling.style.display="flex"},onLoad:e=>{console.log("Dialog image loaded successfully:",Z.file_url),e.target.nextSibling.style.display="none"}}),(0,t.jsx)("div",{className:"w-full h-[60vh] bg-gray-200 flex items-center justify-center",style:{display:"none"},children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Image unavailable"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Unable to load image from server"})]})})]}):"youtube_video"===Z.media_type?(0,t.jsx)("div",{className:"w-full aspect-video",children:(0,t.jsx)("iframe",{src:(null===(l=Z.youtube_url)||void 0===l?void 0:l.includes("youtube.com"))||(null===(a=Z.youtube_url)||void 0===a?void 0:a.includes("youtu.be"))?Z.youtube_url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"):Z.youtube_url,width:"100%",height:"100%",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full"})}):(0,t.jsx)("video",{src:Z.file_url,controls:!0,autoPlay:!0,className:"w-full h-auto max-h-[60vh] mx-auto",children:"Your browser does not support the video tag."})}),(0,t.jsxs)("div",{className:"space-y-2",children:[Z.caption&&(0,t.jsx)("p",{className:"text-sm text-gray-700",children:Z.caption}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(g.Z,{className:"w-4 h-4 mr-1"}),(0,_.WU)(new Date(Z.uploaded_at),"PPp")]}),"video"===Z.media_type&&Z.duration&&(0,t.jsxs)("span",{children:["Duration: ",Math.floor(Z.duration/60),":",(Z.duration%60).toString().padStart(2,"0")]}),"youtube_video"===Z.media_type&&Z.view_count&&(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(x.Z,{className:"w-4 h-4 mr-1"}),Z.view_count.toLocaleString()," views"]}),Z.width&&Z.height&&(0,t.jsxs)("span",{children:[Z.width,"x",Z.height]})]}),"youtube_video"===Z.media_type?(0,t.jsxs)("a",{href:Z.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-red-600 hover:text-red-700",children:[(0,t.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),"Watch on YouTube"]}):(0,t.jsxs)("a",{href:Z.file_url,download:!0,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-rose-600 hover:text-rose-700",children:[(0,t.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"Download"]})]})]})]})]})})})]})}a(57818)}}]);