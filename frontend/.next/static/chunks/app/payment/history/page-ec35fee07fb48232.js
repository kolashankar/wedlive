(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5519,6657],{90238:function(e,t,r){Promise.resolve().then(r.bind(r,84359))},84359:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var s=r(57437),n=r(2265),a=r(15730),o=r(16463),i=r(56360),l=r(10273),c=r(79004),d=r(92940),u=r(40933),m=r(71935),x=r(3274),p=r(88592),g=r(95137);let h=(0,r(78030).Z)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var f=r(24241),v=r(37164),y=r(87138),b=r(6657),w=r(27776);function N(){let{user:e,loading:t}=(0,a.a)(),r=(0,o.useRouter)(),[N,j]=(0,n.useState)([]),[_,k]=(0,n.useState)(!0),[E,I]=(0,n.useState)("TEST");(0,n.useEffect)(()=>{t||e?e&&R():r.push("/login")},[e,t]);let R=async()=>{try{k(!0);let e=await b.default.get("/api/subscriptions/payment-history?limit=100");e.data&&(j(e.data.payments||[]),I(e.data.mode||"TEST"))}catch(e){console.error("Failed to load payment history:",e),w.toast.error("Failed to load payment history")}finally{k(!1)}},T=e=>{switch(e){case"active":case"paid":case"success":return(0,s.jsx)(d.Z,{className:"w-5 h-5 text-green-500"});case"pending":case"created":return(0,s.jsx)(u.Z,{className:"w-5 h-5 text-yellow-500"});case"cancelled":case"failed":case"payment_failed":return(0,s.jsx)(m.Z,{className:"w-5 h-5 text-red-500"});default:return(0,s.jsx)(u.Z,{className:"w-5 h-5 text-gray-500"})}},P=e=>(0,s.jsx)(c.C,{className:"".concat({active:"bg-green-100 text-green-700",paid:"bg-green-100 text-green-700",success:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",created:"bg-yellow-100 text-yellow-700",cancelled:"bg-red-100 text-red-700",failed:"bg-red-100 text-red-700",payment_failed:"bg-red-100 text-red-700"}[e]||"bg-gray-100 text-gray-700"," border-0"),children:e.toUpperCase()}),S=e=>{let t=(e/100).toFixed(2);return"₹".concat(t)},A=e=>e?new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Z=e=>{r.push("/payment/invoice/".concat(e.id))};return t||_?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center",children:(0,s.jsx)(x.Z,{className:"w-8 h-8 animate-spin text-rose-500"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50",children:[(0,s.jsx)("nav",{className:"bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)(y.default,{href:"/",className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-rose-500 to-purple-600 p-2 rounded-lg",children:(0,s.jsx)(p.Z,{className:"w-6 h-6 text-white"})}),(0,s.jsx)("span",{className:"text-xl font-bold bg-gradient-to-r from-rose-600 to-purple-600 bg-clip-text text-transparent",children:"WedLive"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsx)(y.default,{href:"/dashboard",children:(0,s.jsxs)(i.z,{variant:"ghost",children:[(0,s.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"Dashboard"]})})})]})})}),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-rose-600 to-purple-600 bg-clip-text text-transparent",children:"Payment History"}),"TEST"===E&&(0,s.jsx)(c.C,{className:"bg-yellow-100 text-yellow-800 border-yellow-300",children:"TEST MODE"})]}),(0,s.jsx)("p",{className:"text-gray-600",children:"View all your transactions and download invoices"})]}),0===N.length?(0,s.jsx)(l.Zb,{children:(0,s.jsxs)(l.aY,{className:"py-12 text-center",children:[(0,s.jsx)(h,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No payments yet"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"Your payment history will appear here once you make a purchase"}),(0,s.jsx)(y.default,{href:"/pricing",children:(0,s.jsx)(i.z,{className:"bg-gradient-to-r from-rose-500 to-purple-600 text-white",children:"View Plans"})})]})}):(0,s.jsx)("div",{className:"space-y-4",children:N.map(e=>{var t;return(0,s.jsx)(l.Zb,{className:"hover:shadow-lg transition-shadow",children:(0,s.jsx)(l.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(0,s.jsx)("div",{className:"p-3 bg-gradient-to-br from-rose-100 to-purple-100 rounded-lg",children:T(e.status)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"subscription"===e.type?"".concat("monthly"===e.plan?"Monthly":"Yearly"," Premium Subscription"):(null===(t=e.notes)||void 0===t?void 0:t.description)||"One-Time Payment"}),P(e.status)]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(f.Z,{className:"w-4 h-4 mr-2 text-gray-400"}),A(e.created_at)]}),e.razorpay_payment_id&&(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(h,{className:"w-4 h-4 mr-2 text-gray-400"}),"ID: ",e.razorpay_payment_id.substring(0,20),"..."]})]}),e.paid_at&&(0,s.jsxs)("div",{className:"text-sm text-green-600 mt-2",children:["✓ Paid on ",A(e.paid_at)]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end space-y-3 ml-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-2xl font-bold bg-gradient-to-r from-rose-600 to-purple-600 bg-clip-text text-transparent",children:S(e.amount)}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.currency||"INR"})]}),("active"===e.status||"paid"===e.status||"success"===e.status)&&(0,s.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>Z(e),className:"border-rose-200 hover:bg-rose-50",children:[(0,s.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Invoice"]})]})]})})},e.id)})}),N.length>0&&(0,s.jsxs)(l.Zb,{className:"mt-8 bg-gradient-to-br from-rose-50 to-purple-50",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Summary"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Payments"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:N.length})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Successful"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:N.filter(e=>["active","paid","success"].includes(e.status)).length})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Pending"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:N.filter(e=>["pending","created"].includes(e.status)).length})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Spent"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:S(N.filter(e=>["active","paid","success"].includes(e.status)).reduce((e,t)=>e+(t.amount||0),0))})]})]})})]})]})]})}},79004:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var s=r(57437);r(2265);var n=r(13027),a=r(77700);let o=(0,n.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(o({variant:r}),t),...n})}},56360:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(57437),n=r(2265),a=r(71538),o=r(13027),i=r(77700);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,s.jsx)(u,{className:(0,i.cn)(l({variant:n,size:o,className:r})),ref:t,...d})});c.displayName="Button"},10273:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var s=r(57437),n=r(2265),a=r(77700);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...n})});o.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",r),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})});u.displayName="CardFooter"},6657:function(e,t,r){"use strict";r.r(t);var s=r(38472),n=r(78614);(0,n.ww)(),console.log("API Base URL:",(0,n.bR)());let a=s.Z.create({baseURL:(0,n.bR)(),headers:{"Content-Type":"application/json"},timeout:n.ZP.API.TIMEOUT});a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),a.interceptors.response.use(e=>e,async e=>{var t,r,s,o,i,l,c;let d=e.config;if(console.error("API Error:",e),"ECONNABORTED"===e.code||"Network Error"===e.message){if(d.__retryCount||(d.__retryCount=0),d.__retryCount<n.ZP.API.RETRY_ATTEMPTS)return d.__retryCount+=1,console.warn("Retrying request (".concat(d.__retryCount,"/").concat(n.ZP.API.RETRY_ATTEMPTS,")...")),await new Promise(e=>setTimeout(e,n.ZP.API.RETRY_DELAY*d.__retryCount)),a(d);console.error("Request timeout after retries - API might be down")}if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("❌ Authentication failed - token expired or invalid"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(o=window.toast)||void 0===o||o.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true"),(null===(r=e.response)||void 0===r?void 0:r.status)===403){console.error("❌ Access forbidden - you may not have permission or your session expired");let t=(null===(l=e.response)||void 0===l?void 0:null===(i=l.data)||void 0===i?void 0:i.detail)||"";(t.toLowerCase().includes("not authorized")||t.toLowerCase().includes("permission"))&&(console.warn("⚠️ Token may be expired - redirecting to login"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(c=window.toast)||void 0===c||c.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true")}return(null===(s=e.response)||void 0===s?void 0:s.status)===404&&console.error("Resource not found - check API endpoint"),Promise.reject(e)}),t.default=a},15730:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return c}});var s=r(57437),n=r(2265),a=r(6657);let o=(0,n.createContext)({});function i(e){if(!e)return!0;let t=function(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(r)}catch(e){return console.error("Failed to decode JWT:",e),null}}(e);return!t||!t.exp||1e3*t.exp-Date.now()<3e5}let l=e=>{let{children:t}=e,[r,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(i(e)?(console.warn("⚠️ JWT token expired - clearing auth state"),localStorage.removeItem("token"),localStorage.removeItem("user"),d(null),l(null)):(d(e),l(JSON.parse(t)))),m(!1)},[]);let x=async(e,t)=>{let{access_token:r,user:s}=(await a.default.post("/api/auth/login",{email:e,password:t})).data;return localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(s)),d(r),l(s),s},p=async(e,t,r)=>{let{access_token:s,user:n}=(await a.default.post("/api/auth/register",{email:e,password:t,full_name:r})).data;return localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(n)),d(s),l(n),n},g=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),d(null),l(null),window.location.href="/"},h=async()=>{try{let e=(await a.default.get("/api/auth/me")).data;return localStorage.setItem("user",JSON.stringify(e)),l(e),e}catch(t){var e;return console.error("Failed to refresh user data:",t),(null===(e=t.response)||void 0===e?void 0:e.status)===401&&(console.error("❌ Token invalid - logging out"),g()),null}};return(0,n.useEffect)(()=>{if(!c)return;let e=setInterval(()=>{i(c)&&(console.warn("⚠️ JWT token expired - logging out"),g())},6e4);return()=>clearInterval(e)},[c]),(0,s.jsx)(o.Provider,{value:{user:r,token:c,setToken:d,setUser:l,login:x,register:p,logout:g,refreshUser:h,loading:u,isTokenExpired:()=>i(c)},children:t})},c=()=>(0,n.useContext)(o)},78614:function(e,t,r){"use strict";r.d(t,{bR:function(){return o},ww:function(){return i}});var s=r(20357);let n=()=>{{let e=window.location.hostname;return e.includes("vercel.app")||e.includes("wedlive.vercel.app")}},a={API:{BASE_URL:(()=>{let e=s.env.NEXT_PUBLIC_BACKEND_URL||s.env.REACT_APP_BACKEND_URL||s.env.NEXT_PUBLIC_API_URL;if(e)return e;{let e=window.location.hostname;if(e.includes("emergentagent.com")||e.includes("preview.emergentagent.com"))return window.location.origin;if(e.includes("vercel.app")||e.includes("wedlive.vercel.app"))return"https://wedlive.onrender.com";e.includes("localhost")||e.includes("127.0.0.1")}return"http://localhost:8001"})(),TIMEOUT:3e5,RETRY_ATTEMPTS:2,RETRY_DELAY:1e3},MEDIA:{PROXY_ENDPOINT:"/api/media/telegram-proxy/photos/",SUPPORTED_FORMATS:["jpg","jpeg","png","webp"],MAX_FILE_SIZE:10485760},IMAGE:{MAX_RETRIES:2,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3,LOADING_PLACEHOLDER:"/images/placeholder.jpg"}},o=()=>a.API.BASE_URL,i=()=>{let e=o(),t=e.includes("localhost"),r=n();return console.log("\uD83D\uDD27 Configuration Validation:",{apiBaseUrl:e,environment:r?"production":"development",isLocal:t,mediaProxy:a.MEDIA.PROXY_ENDPOINT}),r&&t&&(console.error("❌ ERROR: Production frontend using localhost backend URL!"),console.error("Update NEXT_PUBLIC_API_URL in Vercel environment variables to: https://wedlive.onrender.com")),e.includes("8000")&&console.warn("⚠️ WARNING: API base URL is using port 8000, expected 8001 for local or 443 for production"),!0};t.ZP=a},77700:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(44839),n=r(96164);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}},95137:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},24241:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},92940:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},71935:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},40933:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},88592:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},37164:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},3274:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(78030).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[9767,4868,7776,7515,2971,7023,1744],function(){return e(e.s=90238)}),_N_E=e.O()}]);