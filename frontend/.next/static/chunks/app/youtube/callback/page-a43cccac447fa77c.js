(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1299,6657],{87601:function(e,t,o){Promise.resolve().then(o.bind(o,87700))},87700:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return m}});var r=o(57437),n=o(2265),s=o(16463),a=o(3274),i=o(92940),c=o(71935),l=o(27776),u=o(6657);function d(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),[o,d]=(0,n.useState)("processing"),[m,p]=(0,n.useState)("Connecting your YouTube account...");return(0,n.useEffect)(()=>{(async()=>{try{let o=t.get("code"),r=t.get("state");if(!o||!r){d("error"),p("Missing authorization code or state");return}let n=sessionStorage.getItem("youtube_state"),s=sessionStorage.getItem("youtube_wedding_id");if(!n||r!==n){d("error"),p("Invalid state parameter. Please try again.");return}await u.default.post("/api/youtube/callback",{code:o,state:r}),p("Creating YouTube broadcast..."),await u.default.post("/api/youtube/create-broadcast/".concat(s)),sessionStorage.removeItem("youtube_state"),sessionStorage.removeItem("youtube_wedding_id"),d("success"),p("YouTube account connected successfully!"),l.toast.success("YouTube connected! Broadcast created."),setTimeout(()=>{e.push("/weddings/manage/".concat(s))},2e3)}catch(e){var o,r;console.error("YouTube callback error:",e),d("error"),p((null===(r=e.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.detail)||"Failed to connect YouTube account"),l.toast.error("Failed to connect YouTube")}})()},[t,e]),(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:(0,r.jsxs)("div",{className:"text-center",children:["processing"===o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{className:"w-16 h-16 text-rose-500 animate-spin mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Connecting YouTube"}),(0,r.jsx)("p",{className:"text-gray-600",children:m})]}),"success"===o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-green-800 mb-2",children:"Success!"}),(0,r.jsx)("p",{className:"text-gray-600",children:m}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Redirecting you back..."})]}),"error"===o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-red-800 mb-2",children:"Connection Failed"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,r.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"px-6 py-2 bg-rose-500 text-white rounded-lg hover:bg-rose-600 transition",children:"Go to Dashboard"})]})]})})})}function m(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(a.Z,{className:"w-16 h-16 text-rose-500 animate-spin mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Loading..."}),(0,r.jsx)("p",{className:"text-gray-600",children:"Processing YouTube callback"})]})})}),children:(0,r.jsx)(d,{})})}},6657:function(e,t,o){"use strict";o.r(t);var r=o(38472),n=o(78614);(0,n.ww)(),console.log("API Base URL:",(0,n.bR)());let s=r.Z.create({baseURL:(0,n.bR)(),headers:{"Content-Type":"application/json"},timeout:n.ZP.API.TIMEOUT});s.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),s.interceptors.response.use(e=>e,async e=>{var t,o,r,a,i,c,l;let u=e.config;if(console.error("API Error:",e),"ECONNABORTED"===e.code||"Network Error"===e.message){if(u.__retryCount||(u.__retryCount=0),u.__retryCount<n.ZP.API.RETRY_ATTEMPTS)return u.__retryCount+=1,console.warn("Retrying request (".concat(u.__retryCount,"/").concat(n.ZP.API.RETRY_ATTEMPTS,")...")),await new Promise(e=>setTimeout(e,n.ZP.API.RETRY_DELAY*u.__retryCount)),s(u);console.error("Request timeout after retries - API might be down")}if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("❌ Authentication failed - token expired or invalid"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(a=window.toast)||void 0===a||a.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true"),(null===(o=e.response)||void 0===o?void 0:o.status)===403){console.error("❌ Access forbidden - you may not have permission or your session expired");let t=(null===(c=e.response)||void 0===c?void 0:null===(i=c.data)||void 0===i?void 0:i.detail)||"";(t.toLowerCase().includes("not authorized")||t.toLowerCase().includes("permission"))&&(console.warn("⚠️ Token may be expired - redirecting to login"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(l=window.toast)||void 0===l||l.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true")}return(null===(r=e.response)||void 0===r?void 0:r.status)===404&&console.error("Resource not found - check API endpoint"),Promise.reject(e)}),t.default=s},78614:function(e,t,o){"use strict";o.d(t,{bR:function(){return a},ww:function(){return i}});var r=o(20357);let n=()=>{{let e=window.location.hostname;return e.includes("vercel.app")||e.includes("wedlive.vercel.app")}},s={API:{BASE_URL:(()=>{let e=r.env.NEXT_PUBLIC_BACKEND_URL||r.env.REACT_APP_BACKEND_URL||r.env.NEXT_PUBLIC_API_URL;if(e)return e;{let e=window.location.hostname;if(e.includes("emergentagent.com")||e.includes("preview.emergentagent.com"))return window.location.origin;if(e.includes("vercel.app")||e.includes("wedlive.vercel.app"))return"https://wedlive.onrender.com";e.includes("localhost")||e.includes("127.0.0.1")}return"http://localhost:8001"})(),TIMEOUT:3e5,RETRY_ATTEMPTS:2,RETRY_DELAY:1e3},MEDIA:{PROXY_ENDPOINT:"/api/media/telegram-proxy/photos/",SUPPORTED_FORMATS:["jpg","jpeg","png","webp"],MAX_FILE_SIZE:10485760},IMAGE:{MAX_RETRIES:2,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3,LOADING_PLACEHOLDER:"/images/placeholder.jpg"}},a=()=>s.API.BASE_URL,i=()=>{let e=a(),t=e.includes("localhost"),o=n();return console.log("\uD83D\uDD27 Configuration Validation:",{apiBaseUrl:e,environment:o?"production":"development",isLocal:t,mediaProxy:s.MEDIA.PROXY_ENDPOINT}),o&&t&&(console.error("❌ ERROR: Production frontend using localhost backend URL!"),console.error("Update NEXT_PUBLIC_API_URL in Vercel environment variables to: https://wedlive.onrender.com")),e.includes("8000")&&console.warn("⚠️ WARNING: API base URL is using port 8000, expected 8001 for local or 443 for production"),!0};t.ZP=s},92940:function(e,t,o){"use strict";o.d(t,{Z:function(){return r}});let r=(0,o(78030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},71935:function(e,t,o){"use strict";o.d(t,{Z:function(){return r}});let r=(0,o(78030).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},3274:function(e,t,o){"use strict";o.d(t,{Z:function(){return r}});let r=(0,o(78030).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[9767,7776,2971,7023,1744],function(){return e(e.s=87601)}),_N_E=e.O()}]);