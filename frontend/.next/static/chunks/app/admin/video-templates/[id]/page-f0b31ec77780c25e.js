(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2609,6657],{54176:function(e,t,i){Promise.resolve().then(i.bind(i,97759))},97759:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return K}});var a=i(57437),n=i(2265),l=i(16463),s=i(38472),r=i(88492),o=i.n(r),d=i(10273),c=i(56360),u=i(46260),m=i(65236),h=i(25797),x=i(79004),v=i(10464),p=i(92404),f=i(85398),g=i(80492),y=i(33907),b=i(59061);let j=[{value:"bride_name",label:"Bride's Name"},{value:"groom_name",label:"Groom's Name"},{value:"bride_first_name",label:"Bride's First Name"},{value:"groom_first_name",label:"Groom's First Name"},{value:"couple_names",label:"Couple Names"},{value:"event_date",label:"Event Date (Day)"},{value:"event_date_full",label:"Event Date (Full)"},{value:"event_month",label:"Event Month"},{value:"event_year",label:"Event Year"},{value:"event_day",label:"Event Day"},{value:"event_time",label:"Event Time"},{value:"venue",label:"Venue"},{value:"venue_address",label:"Venue Address"},{value:"city",label:"City"},{value:"welcome_message",label:"Welcome Message"},{value:"description",label:"Description"},{value:"countdown_days",label:"Countdown Days"},{value:"custom_text_1",label:"Custom Text 1"},{value:"custom_text_2",label:"Custom Text 2"},{value:"custom_text_3",label:"Custom Text 3"},{value:"custom_text_4",label:"Custom Text 4"},{value:"custom_text_5",label:"Custom Text 5"}],w=[{value:"fade-in",label:"Fade In"},{value:"fade-out",label:"Fade Out"},{value:"slide-up",label:"Slide Up"},{value:"slide-down",label:"Slide Down"},{value:"slide-left",label:"Slide Left"},{value:"slide-right",label:"Slide Right"},{value:"scale-up",label:"Scale Up"},{value:"scale-down",label:"Scale Down"},{value:"zoom-in",label:"Zoom In"},{value:"bounce-in",label:"Bounce In"},{value:"bounce-out",label:"Bounce Out"},{value:"rotate-in",label:"Rotate In"},{value:"spin",label:"Spin"},{value:"typewriter",label:"Typewriter"},{value:"blur-in",label:"Blur In"},{value:"blur-out",label:"Blur Out"},{value:"fade-slide-up",label:"Fade + Slide Up"},{value:"scale-fade",label:"Scale + Fade"}],_=["Playfair Display","Montserrat","Roboto","Open Sans","Lato","Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Trebuchet MS","Palatino","Garamond","Impact"],N=[{value:"normal",label:"Normal"},{value:"bold",label:"Bold"},{value:"100",label:"Thin"},{value:"300",label:"Light"},{value:"500",label:"Medium"},{value:"700",label:"Bold"},{value:"900",label:"Black"}],k=[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}],C=[{value:"ease-in-out",label:"Ease In-Out"},{value:"ease-in",label:"Ease In"},{value:"ease-out",label:"Ease Out"},{value:"linear",label:"Linear"},{value:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",label:"Bounce"}];function S(e){var t,i,l,s,r;let{overlay:o,duration:d,currentTime:x,onUpdate:S,onSeek:E}=e,[R,A]=(0,n.useState)(L()),[z,P]=(0,n.useState)({}),D=(0,n.useRef)(!1),M=(null==o?void 0:null===(t=o.template)||void 0===t?void 0:t.reference_resolution)||{width:1920,height:1080},I=e=>(e/(M.height||1080)*100).toFixed(2),O=(e,t)=>t&&0!==t?(e/t).toFixed(3):0,B=(e,t)=>t&&0!==t?(e/t).toFixed(3):0;function L(){var e,t,i,a,n,l,s,r,c,u,m,h,x,v,p,f,g,y,b,j,w,_,N,k,C,S,T,E,R,A,z,P,D,M,I;return{endpoint_key:null!==(p=null==o?void 0:o.endpoint_key)&&void 0!==p?p:"couple_names",label:null!==(f=null==o?void 0:o.label)&&void 0!==f?f:"Couple Names",placeholder_text:null!==(g=null==o?void 0:o.placeholder_text)&&void 0!==g?g:"Sample Text",position:null!==(y=null==o?void 0:o.position)&&void 0!==y?y:{x:50,y:50,alignment:"center",anchor_point:"center",unit:"percent"},dimensions:null!==(b=null==o?void 0:o.dimensions)&&void 0!==b?b:{width:50,height:null,unit:"percent"},timing:null!==(j=null==o?void 0:o.timing)&&void 0!==j?j:{start_time:0,end_time:d||10},styling:{font_family:null!==(w=null==o?void 0:null===(e=o.styling)||void 0===e?void 0:e.font_family)&&void 0!==w?w:"Playfair Display",font_size:null!==(_=null==o?void 0:null===(t=o.styling)||void 0===t?void 0:t.font_size)&&void 0!==_?_:72,font_weight:null!==(N=null==o?void 0:null===(i=o.styling)||void 0===i?void 0:i.font_weight)&&void 0!==N?N:"bold",color:null!==(k=null==o?void 0:null===(a=o.styling)||void 0===a?void 0:a.color)&&void 0!==k?k:"#ffffff",text_align:null!==(C=null==o?void 0:null===(n=o.styling)||void 0===n?void 0:n.text_align)&&void 0!==C?C:"center",letter_spacing:null!==(S=null==o?void 0:null===(l=o.styling)||void 0===l?void 0:l.letter_spacing)&&void 0!==S?S:2,line_height:null!==(T=null==o?void 0:null===(s=o.styling)||void 0===s?void 0:s.line_height)&&void 0!==T?T:1.2,text_shadow:null!==(E=null==o?void 0:null===(r=o.styling)||void 0===r?void 0:r.text_shadow)&&void 0!==E?E:"0 2px 4px rgba(0,0,0,0.3)",stroke:null!==(R=null==o?void 0:null===(c=o.styling)||void 0===c?void 0:c.stroke)&&void 0!==R?R:{enabled:!1,color:"#000000",width:2}},animation:{type:null!==(A=null==o?void 0:null===(u=o.animation)||void 0===u?void 0:u.type)&&void 0!==A?A:"fade-in",duration:null!==(z=null==o?void 0:null===(m=o.animation)||void 0===m?void 0:m.duration)&&void 0!==z?z:1,easing:null!==(P=null==o?void 0:null===(h=o.animation)||void 0===h?void 0:h.easing)&&void 0!==P?P:"ease-in-out",entrance:null!==(D=null==o?void 0:null===(x=o.animation)||void 0===x?void 0:x.entrance)&&void 0!==D?D:{type:"fade-in",duration:1,easing:"ease-in-out"},exit:null!==(M=null==o?void 0:null===(v=o.animation)||void 0===v?void 0:v.exit)&&void 0!==M?M:{type:"fade-out",duration:1,easing:"ease-in-out"}},responsive:null!==(I=null==o?void 0:o.responsive)&&void 0!==I?I:{mobile_font_size:48,mobile_position:{x:50,y:30,unit:"percent"}}}}(0,n.useEffect)(()=>{o&&!D.current&&(A(L()),P({}))},[null==o?void 0:o.id,d]),(0,n.useEffect)(()=>{let e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=".concat("Playfair+Display:wght@400;600;700&family=Montserrat:wght@400;600;700&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700","&display=swap"),e.rel="stylesheet",document.querySelector('link[href*="fonts.googleapis.com"]')||document.head.appendChild(e)},[]);let F=(e,t)=>{A(i=>{let a={...i},n=e.split("."),l=a;for(let e=0;e<n.length-1;e++)l[n[e]]?l[n[e]]={...l[n[e]]}:l[n[e]]={},l=l[n[e]];return l[n[n.length-1]]=t,a}),P(i=>{let a={...i},n=e.split("."),l=a;for(let e=0;e<n.length-1;e++)l[n[e]]||(l[n[e]]={}),l=l[n[e]];return l[n[n.length-1]]=t,a}),Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{U()},100)},Z=(0,n.useRef)(null);(0,n.useEffect)(()=>()=>{Z.current&&clearTimeout(Z.current)},[]);let U=async()=>{if(0===Object.keys(z).length)return;D.current=!0;let e={};void 0!==z.endpoint_key&&(e.endpoint_key=R.endpoint_key),void 0!==z.label&&(e.label=R.label),void 0!==z.placeholder_text&&(e.placeholder_text=R.placeholder_text),z.position&&(e.position=R.position),z.dimensions&&(e.dimensions=R.dimensions),z.timing&&(e.timing=R.timing),z.responsive&&(e.responsive=R.responsive),void 0!==z.layer_index&&(e.layer_index=R.layer_index),z.styling&&(e.styling={font_family:R.styling.font_family,font_size:R.styling.font_size,font_weight:R.styling.font_weight,color:R.styling.color,text_align:R.styling.text_align,letter_spacing:R.styling.letter_spacing,line_height:R.styling.line_height,text_shadow:R.styling.text_shadow,stroke:{enabled:R.styling.stroke.enabled,color:R.styling.stroke.color,width:R.styling.stroke.width}}),z.animation&&(e.animation={type:R.animation.type,duration:R.animation.duration,easing:R.animation.easing,entrance:{type:R.animation.entrance.type,duration:R.animation.entrance.duration,easing:R.animation.entrance.easing},exit:{type:R.animation.exit.type,duration:R.animation.exit.duration,easing:R.animation.exit.easing}}),console.log("Saving overlay update with changes:",e);try{await S(e),P({})}finally{setTimeout(()=>{D.current=!1},100)}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 text-blue-500"}),"Configure Overlay"]}),(0,a.jsx)(c.z,{size:"sm",onClick:U,"data-testid":"save-overlay-btn",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-blue-900 mb-1",children:"\uD83D\uDCA1 Interactive Controls"}),(0,a.jsxs)("ul",{className:"text-xs text-blue-800 space-y-1",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Drag"})," the overlay on the video to reposition"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Resize"})," using the corner/edge handles"]}),(0,a.jsxs)("li",{children:["• Hold ",(0,a.jsx)("strong",{children:"Shift"})," while resizing for proportional scaling"]})]})]}),(0,a.jsx)(h.x,{className:"h-[calc(100vh-280px)]",children:(0,a.jsxs)(m.mQ,{defaultValue:"content",className:"w-full",children:[(0,a.jsxs)(m.dr,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(m.SP,{value:"content",children:"Content"}),(0,a.jsx)(m.SP,{value:"style",children:"Style"}),(0,a.jsx)(m.SP,{value:"timing",children:"Timing"}),(0,a.jsx)(m.SP,{value:"animation",children:"Animation"})]}),(0,a.jsxs)(m.nU,{value:"content",className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Data Source"}),(0,a.jsxs)(u.Ph,{value:R.endpoint_key,onValueChange:e=>{F("endpoint_key",e);let t=j.find(t=>t.value===e);t&&F("label",t.label)},children:[(0,a.jsx)(u.i4,{className:"mt-1","data-testid":"endpoint-select",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:j.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Preview Text"}),(0,a.jsx)(p.I,{value:R.placeholder_text,onChange:e=>F("placeholder_text",e.target.value),placeholder:"Sample text for preview",className:"mt-1","data-testid":"placeholder-text-input"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"This text will be shown in preview. Real wedding data will populate automatically."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Position (Drag on video or use inputs)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{className:"text-xs",children:"X (%)"}),(0,a.jsx)(p.I,{type:"number",min:"0",max:"100",step:"0.1",value:R.position.x,onChange:e=>F("position.x",parseFloat(e.target.value)||0),className:"mt-1","data-testid":"position-x-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{className:"text-xs",children:"Y (%)"}),(0,a.jsx)(p.I,{type:"number",min:"0",max:"100",step:"0.1",value:R.position.y,onChange:e=>F("position.y",parseFloat(e.target.value)||0),className:"mt-1","data-testid":"position-y-input"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Percentage-based positioning (0-100%). Center: (50%, 50%)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Text Box Width: ",(null===(i=R.dimensions)||void 0===i?void 0:i.width)||"Auto","%"]}),(0,a.jsx)(f.i,{value:[(null===(l=R.dimensions)||void 0===l?void 0:l.width)||50],onValueChange:e=>{let[t]=e;return F("dimensions.width",t)},min:10,max:100,step:1,className:"mt-2","data-testid":"textbox-width-slider"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Controls text wrapping width. Text will automatically wrap to new lines when it exceeds this width."})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Text Box Height: ",(null===(s=R.dimensions)||void 0===s?void 0:s.height)?"".concat(R.dimensions.height,"%"):"Auto"]}),(0,a.jsx)(f.i,{value:[(null===(r=R.dimensions)||void 0===r?void 0:r.height)||20],onValueChange:e=>{let[t]=e;return F("dimensions.height",t)},min:5,max:100,step:1,className:"mt-2","data-testid":"textbox-height-slider"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Controls text box height. Set to control vertical space for text. Text will wrap within this box."})]})]}),(0,a.jsxs)(m.nU,{value:"style",className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Font Family"}),(0,a.jsxs)(u.Ph,{value:R.styling.font_family,onValueChange:e=>F("styling.font_family",e),children:[(0,a.jsx)(u.i4,{className:"mt-1","data-testid":"font-family-select",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:_.map(e=>(0,a.jsx)(u.Ql,{value:e,children:(0,a.jsx)("span",{style:{fontFamily:e},children:e})},e))})]}),(0,a.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 rounded-md border",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Preview:"}),(0,a.jsx)("p",{className:"text-2xl font-medium",style:{fontFamily:R.styling.font_family},children:(null==o?void 0:o.placeholder_text)||R.placeholder_text||"Sample Text"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Font Size: ",R.styling.font_size,"px (",I(R.styling.font_size),"% of video height)"]}),(0,a.jsx)(f.i,{value:[R.styling.font_size],onValueChange:e=>{let[t]=e;return F("styling.font_size",t)},min:12,max:200,step:1,className:"mt-2","data-testid":"font-size-slider"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Font will automatically scale on all devices. ",I(R.styling.font_size),"% = ",R.styling.font_size,"px on ",M.height,"px video"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Font Weight"}),(0,a.jsxs)(u.Ph,{value:R.styling.font_weight,onValueChange:e=>F("styling.font_weight",e),children:[(0,a.jsx)(u.i4,{className:"mt-1",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:N.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Text Color"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)(p.I,{type:"color",value:R.styling.color,onChange:e=>{F("styling.color",e.target.value),setTimeout(()=>U(),10)},onInput:e=>{F("styling.color",e.target.value)},className:"w-20 h-10 p-1","data-testid":"text-color-input"}),(0,a.jsx)(p.I,{type:"text",value:R.styling.color,onChange:e=>{F("styling.color",e.target.value)},onBlur:()=>{U()},placeholder:"#ffffff",className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Text Alignment"}),(0,a.jsxs)(u.Ph,{value:R.styling.text_align,onValueChange:e=>F("styling.text_align",e),children:[(0,a.jsx)(u.i4,{className:"mt-1",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:k.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Letter Spacing: ",R.styling.letter_spacing,"px (",O(R.styling.letter_spacing,R.styling.font_size),"em)"]}),(0,a.jsx)(f.i,{value:[R.styling.letter_spacing],onValueChange:e=>{let[t]=e;return F("styling.letter_spacing",t)},min:0,max:20,step:1,className:"mt-2"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Responsive unit: ",O(R.styling.letter_spacing,R.styling.font_size),"em scales automatically with font size"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Line Height: ",R.styling.line_height]}),(0,a.jsx)(f.i,{value:[R.styling.line_height],onValueChange:e=>{let[t]=e;return F("styling.line_height",t)},min:.8,max:3,step:.1,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Already using responsive ratio (1.0 = normal, 1.5 = 1.5x spacing). Scales automatically with all screen sizes."})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)(v._,{children:"Text Stroke/Outline"}),(0,a.jsx)(g.r,{checked:R.styling.stroke.enabled,onCheckedChange:e=>F("styling.stroke.enabled",e),"data-testid":"stroke-enabled-switch"})]}),R.styling.stroke.enabled&&(0,a.jsxs)("div",{className:"space-y-3 pl-4 border-l-2 border-blue-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{className:"text-xs",children:"Stroke Color"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)(p.I,{type:"color",value:R.styling.stroke.color,onChange:e=>F("styling.stroke.color",e.target.value),className:"w-16 h-8 p-1"}),(0,a.jsx)(p.I,{type:"text",value:R.styling.stroke.color,onChange:e=>F("styling.stroke.color",e.target.value),className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{className:"text-xs",children:["Stroke Width: ",R.styling.stroke.width,"px (",B(R.styling.stroke.width,R.styling.font_size),"em)"]}),(0,a.jsx)(f.i,{value:[R.styling.stroke.width],onValueChange:e=>{let[t]=e;return F("styling.stroke.width",t)},min:1,max:10,step:1,className:"mt-2"}),(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:[B(R.styling.stroke.width,R.styling.font_size),"em scales proportionally with font size"]})]})]})]})]}),(0,a.jsxs)(m.nU,{value:"timing",className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Start Time: ",T(R.timing.start_time)]}),(0,a.jsx)(f.i,{value:[R.timing.start_time],onValueChange:e=>{let[t]=e;return F("timing.start_time",t)},max:d||100,step:.1,className:"mt-2","data-testid":"start-time-slider"}),(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>{F("timing.start_time",x),E(x)},className:"mt-2 w-full",children:["Set to Current Time (",T(x),")"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["End Time: ",T(R.timing.end_time)]}),(0,a.jsx)(f.i,{value:[R.timing.end_time],onValueChange:e=>{let[t]=e;return F("timing.end_time",t)},max:d||100,step:.1,className:"mt-2","data-testid":"end-time-slider"}),(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>{F("timing.end_time",x),E(x)},className:"mt-2 w-full",children:["Set to Current Time (",T(x),")"]})]}),(0,a.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("p",{className:"text-xs text-blue-900",children:[(0,a.jsx)("strong",{children:"Duration:"})," ",T(R.timing.end_time-R.timing.start_time)]})})]}),(0,a.jsxs)(m.nU,{value:"animation",className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Entrance Animation"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Animation Type"}),(0,a.jsxs)(u.Ph,{value:R.animation.entrance.type,onValueChange:e=>F("animation.entrance.type",e),children:[(0,a.jsx)(u.i4,{className:"mt-1","data-testid":"entrance-animation-select",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:w.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Duration: ",R.animation.entrance.duration,"s"]}),(0,a.jsx)(f.i,{value:[R.animation.entrance.duration],onValueChange:e=>{let[t]=e;return F("animation.entrance.duration",t)},min:.1,max:5,step:.1,className:"mt-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Easing"}),(0,a.jsxs)(u.Ph,{value:R.animation.entrance.easing,onValueChange:e=>F("animation.entrance.easing",e),children:[(0,a.jsx)(u.i4,{className:"mt-1",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:C.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Exit Animation"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Animation Type"}),(0,a.jsxs)(u.Ph,{value:R.animation.exit.type,onValueChange:e=>F("animation.exit.type",e),children:[(0,a.jsx)(u.i4,{className:"mt-1","data-testid":"exit-animation-select",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:w.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(v._,{children:["Duration: ",R.animation.exit.duration,"s"]}),(0,a.jsx)(f.i,{value:[R.animation.exit.duration],onValueChange:e=>{let[t]=e;return F("animation.exit.duration",t)},min:.1,max:5,step:.1,className:"mt-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v._,{children:"Easing"}),(0,a.jsxs)(u.Ph,{value:R.animation.exit.easing,onValueChange:e=>F("animation.exit.easing",e),children:[(0,a.jsx)(u.i4,{className:"mt-1",children:(0,a.jsx)(u.ki,{})}),(0,a.jsx)(u.Bw,{children:C.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]})]}),(0,a.jsx)("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:(0,a.jsxs)("p",{className:"text-xs text-purple-900",children:[(0,a.jsx)("strong",{children:"Tip:"})," Entrance plays when text appears, exit when it disappears"]})})]})]})})]})}function T(e){return!e||isNaN(e)?"0:00":"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"))}var E=i(71322),R=i(10883);let A=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#14b8a6","#f97316","#6366f1","#84cc16"];function z(e){let{overlays:t,duration:i,currentTime:l,selectedOverlay:s,onSelectOverlay:r,onUpdateOverlay:o,onDeleteOverlay:d,onReorder:u,onSeek:m}=e,h=(0,n.useRef)(null),[v,p]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null),[y,b]=(0,n.useState)(null),j=(e,t)=>{t.stopPropagation(),r(e)},w=(e,t,i)=>{i.stopPropagation(),p(!0),g(e),b(t)},_=e=>{if(!v||!f||!h.current)return;let t=h.current.getBoundingClientRect(),a=Math.max(0,Math.min(i,(e.clientX-t.left)/t.width*i)),n={...f.timing};if("start"===y)n.start_time=Math.min(a,n.end_time-.5);else if("end"===y)n.end_time=Math.max(a,n.start_time+.5);else if("move"===y){let e=n.end_time-n.start_time;n.start_time=Math.max(0,Math.min(a,e-e)),n.end_time=n.start_time+e}o(f.id,{timing:n})},N=()=>{p(!1),g(null),b(null)};(0,n.useEffect)(()=>{if(v)return document.addEventListener("mousemove",_),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",N)}},[v,f,y]);let k=e=>A[e%A.length],C=e=>!e||isNaN(e)?"0:00":"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{ref:h,className:"relative bg-gray-100 rounded-lg p-4 min-h-[300px] cursor-pointer",onClick:e=>{if(v)return;let t=e.currentTarget.getBoundingClientRect();m((e.clientX-t.left)/t.width*i)},"data-testid":"timeline-canvas",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 flex justify-between text-xs text-gray-500 px-4 py-2",children:Array.from({length:11},(e,t)=>(0,a.jsx)("span",{children:C(i/10*t)},t))}),(0,a.jsx)("div",{className:"absolute top-8 bottom-0 w-0.5 bg-red-500 z-20",style:{left:"".concat(l/i*100,"%")},children:(0,a.jsx)("div",{className:"absolute -top-2 -left-2 w-4 h-4 bg-red-500 rounded-full"})}),(0,a.jsx)("div",{className:"mt-12 space-y-3",children:0===t.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:'No overlays yet. Click "Add Overlay" to get started.'}):t.map((e,t)=>{var n,l,r,o;let u=((null===(n=e.timing)||void 0===n?void 0:n.start_time)||0)/i*100,m=((null===(l=e.timing)||void 0===l?void 0:l.end_time)||i)/i*100,h=k(t),x=(null==s?void 0:s.id)===e.id;return(0,a.jsxs)("div",{className:"relative h-12","data-testid":"timeline-overlay-".concat(t),children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-200 rounded"}),(0,a.jsxs)("div",{className:"absolute h-full rounded cursor-move transition-all ".concat(x?"ring-2 ring-offset-2 ring-blue-500":""),style:{left:"".concat(u,"%"),width:"".concat(m-u,"%"),backgroundColor:h,opacity:x?1:.8},onClick:t=>j(e,t),onMouseDown:t=>w(e,"move",t),children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-black bg-opacity-30 cursor-ew-resize hover:bg-opacity-50",onMouseDown:t=>w(e,"start",t),onClick:e=>e.stopPropagation()}),(0,a.jsxs)("div",{className:"px-3 py-2 flex items-center justify-between h-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-white text-sm font-medium truncate",children:[(0,a.jsx)(E.Z,{className:"w-3 h-3 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:e.label||e.endpoint_key})]}),(0,a.jsx)(c.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-white hover:bg-white hover:bg-opacity-20",onClick:t=>{t.stopPropagation(),d(e.id)},children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]}),(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-black bg-opacity-30 cursor-ew-resize hover:bg-opacity-50",onMouseDown:t=>w(e,"end",t),onClick:e=>e.stopPropagation()})]}),(0,a.jsx)("div",{className:"absolute -bottom-5 left-0 text-xs text-gray-500",children:C((null===(r=e.timing)||void 0===r?void 0:r.start_time)||0)}),(0,a.jsx)("div",{className:"absolute -bottom-5 right-0 text-xs text-gray-500",children:C((null===(o=e.timing)||void 0===o?void 0:o.end_time)||0)})]},e.id||t)})})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map((e,t)=>(0,a.jsx)(x.C,{className:"cursor-pointer",style:{backgroundColor:k(t)},onClick:()=>r(e),"data-testid":"overlay-badge-".concat(t),children:e.label||e.endpoint_key},e.id||t))}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 bg-blue-50 border border-blue-200 rounded p-3",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"Timeline Controls:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,a.jsx)("li",{children:"Click on timeline to seek to that position"}),(0,a.jsx)("li",{children:"Drag overlay bars to move them"}),(0,a.jsx)("li",{children:"Drag edges to adjust start/end times"}),(0,a.jsx)("li",{children:"Click overlay to select and edit details"})]})]})]})}function P(e){let{overlays:t=[],currentTime:i,duration:l,selectedOverlay:s,showOverlays:r=!0,onSelectOverlay:o,onUpdateOverlay:d,containerRef:c,videoResolution:u=null}=e,m=(null==u?void 0:u.width)||1920,h=(null==u?void 0:u.height)||1080,x=(0,n.useRef)(null),[v,p]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[j,w]=(0,n.useState)({x:0,y:0}),[_,N]=(0,n.useState)({x:0,y:0}),[k,C]=(0,n.useState)(null),[S,T]=(0,n.useState)({}),[E,R]=(0,n.useState)(!1),[A,z]=(0,n.useState)([]),[P,D]=(0,n.useState)(-1),[M,I]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"undefined"!=typeof document&&document.fonts?document.fonts.ready.then(()=>{I(!0)}):I(!0)},[]);let O=(0,n.useCallback)(e=>({x:(void 0!==e.x?e.x:50)/100*m,y:(void 0!==e.y?e.y:50)/100*h}),[m,h]),B=(0,n.useCallback)(e=>({x:Math.round(e.x/m*1e4)/100,y:Math.round(e.y/h*1e4)/100,unit:"percent"}),[m,h]),L=(0,n.useCallback)((e,t,i,a)=>[{x:e,y:t,cursor:"nw-resize",position:"nw"},{x:e+i/2,y:t,cursor:"n-resize",position:"n"},{x:e+i,y:t,cursor:"ne-resize",position:"ne"},{x:e+i,y:t+a/2,cursor:"e-resize",position:"e"},{x:e+i,y:t+a,cursor:"se-resize",position:"se"},{x:e+i/2,y:t+a,cursor:"s-resize",position:"s"},{x:e,y:t+a,cursor:"sw-resize",position:"sw"},{x:e,y:t+a/2,cursor:"w-resize",position:"w"}],[]),F=(0,n.useCallback)(()=>{P>0&&D(P-1)},[P]),Z=(0,n.useCallback)(()=>{P<A.length-1&&D(P+1)},[P,A.length]);(0,n.useEffect)(()=>{let e=e=>{if("Shift"===e.key&&R(!0),s){if(("Delete"===e.key||"Backspace"===e.key)&&e.preventDefault(),e.key.startsWith("Arrow")){e.preventDefault();let t=e.shiftKey?10:1,i={...s.position},a=O(i);switch(e.key){case"ArrowLeft":a.x-=t;break;case"ArrowRight":a.x+=t;break;case"ArrowUp":a.y-=t;break;case"ArrowDown":a.y+=t}let n=B(a);d(s.id,{position:{...i,...n}})}(e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey&&(e.preventDefault(),F()),(e.ctrlKey||e.metaKey)&&("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),Z())}},t=e=>{"Shift"===e.key&&R(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[s,E,d,F,Z]);let U=(0,n.useCallback)(function(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=t.split(" "),l=[],s="";for(let t=0;t<n.length;t++){let r=s?s+" "+n[t]:n[t],o=e.measureText(r).width;a>0&&(o+=a*(r.length-1)),o>i&&s?(l.push(s),s=n[t]):s=r}return s&&l.push(s),l.length>0?l:[t]},[]);(0,n.useEffect)(()=>{if(!M)return;let e=x.current;if(!e)return;let i=e.getContext("2d"),a={};t.forEach(e=>{let t,n;let l=e.placeholder_text||e.endpoint_key||"Sample Text",s=e.styling||{},r=e.dimensions||{},o=s.font_size||48,d=s.font_weight||"normal",c=s.font_family||"Arial",u=s.letter_spacing||0,x=s.line_height||1.2,v=r.width||null,p=v?v/100*m:null,f=r.height||null,g=f?f/100*h:null,y=c.includes(" ")?'"'.concat(c,'"'):c;i.font="".concat(d," ").concat(o,"px ").concat(y);let b=[l];p?(b=U(i,l,p,u),t=p,n=g||b.length*o*x):(t=i.measureText(l).width,u>0&&(t+=u*(l.length-1)),n=g||o*x),a[e.id]={width:t,height:n,baseline:o,lines:b,lineHeight:o*x}}),T(a)},[t,U,M,m,h]);let V=(0,n.useCallback)((e,t,i,a,n,l)=>{let s=t.split(""),r=i,o=s.reduce((t,i)=>t+e.measureText(i).width+n,-n);"center"===e.textAlign?r=i-o/2:"right"===e.textAlign&&(r=i-o),s.forEach(t=>{l?e.strokeText(t,r,a):e.fillText(t,r,a),r+=e.measureText(t).width+n})},[]),Q=(0,n.useCallback)((e,t)=>{switch(t){case"linear":default:return e;case"ease-in":return e*e;case"ease-out":return e*(2-e);case"ease-in-out":return e<.5?2*e*e:-1+(4-2*e)*e;case"cubic-bezier(0.68, -0.55, 0.265, 1.55)":return(1-e)*(1-e)*(1-e)*0+-(3*(1-e)*(1-e)*e*.55)+3*(1-e)*e*e*1.55+e*e*e*1}},[]),Y=(0,n.useCallback)((e,t,i)=>{let a={opacity:1,scale:1,rotation:0,translateX:0,translateY:0},n=1-t,l=i?t:n;switch(e){case"fade-in":case"fade-out":default:a.opacity=l;break;case"slide-up":a.opacity=l,a.translateY=i?-(100*n):100*t;break;case"slide-down":a.opacity=l,a.translateY=i?100*n:-(100*t);break;case"slide-left":a.opacity=l,a.translateX=i?-(100*n):100*t;break;case"slide-right":a.opacity=l,a.translateX=i?100*n:-(100*t);break;case"scale-up":a.opacity=l,a.scale=i?.5+.5*t:.5+.5*n;break;case"scale-down":a.opacity=l,a.scale=i?1.5-.5*t:1.5-.5*n;break;case"zoom-in":a.opacity=l,a.scale=i?t:n;break;case"bounce-in":case"bounce-out":a.opacity=l;let s=i?t:n;a.scale=1+.1*Math.sin(s*Math.PI*3)*(1-s);break;case"rotate-in":a.opacity=l,a.rotation=i?2*Math.PI*n:2*Math.PI*t,a.scale=l;break;case"spin":a.opacity=l,a.rotation=i?4*Math.PI*n:4*Math.PI*t;break;case"blur-in":case"blur-out":a.opacity=l,a.scale=1-.05*n;break;case"fade-slide-up":a.opacity=l,a.translateY=i?-(50*n):50*t;break;case"scale-fade":a.opacity=l,a.scale=i?.8+.2*t:.8+.2*n;break;case"typewriter":a.opacity=1}return a},[]),X=(0,n.useCallback)((e,t)=>{var i,a,n,s;let r=(null===(i=e.timing)||void 0===i?void 0:i.start_time)||0,o=(null===(a=e.timing)||void 0===a?void 0:a.end_time)||l,d=(null===(n=e.animation)||void 0===n?void 0:n.entrance)||{type:"fade-in",duration:1,easing:"ease-in-out"},c=(null===(s=e.animation)||void 0===s?void 0:s.exit)||{type:"fade-out",duration:1,easing:"ease-in-out"},u={opacity:1,scale:1,rotation:0,translateX:0,translateY:0};if(t<r+d.duration){let e=Q(Math.min(1,(t-r)/d.duration),d.easing);u=Y(d.type,e,!0)}else if(t>o-c.duration){let e=Q(Math.min(1,(t-(o-c.duration))/c.duration),c.easing);u=Y(c.type,e,!1)}return u},[l,Q,Y]),G=(0,n.useCallback)((e,t)=>{let a=t.placeholder_text||t.endpoint_key||"Sample Text",n=t.position||{x:50,y:50,unit:"percent"},l=t.styling||{},s=S[t.id],r=O(n),o=l.font_size||48,d=l.font_weight||"normal",c=l.font_family||"Arial",u=l.letter_spacing||0,m=l.line_height||1.2,h=l.text_align||"center",x=c.includes(" ")?'"'.concat(c,'"'):c;e.font="".concat(d," ").concat(o,"px ").concat(x),e.fillStyle=l.color||"#ffffff",e.textAlign=h,e.textBaseline="middle";let v=X(t,i),p=(null==s?void 0:s.lines)||[a],f=(null==s?void 0:s.height)||o*m,g=o*m;e.save(),e.translate(r.x,r.y),e.globalAlpha=v.opacity,e.scale(v.scale,v.scale),e.rotate(v.rotation),e.translate(v.translateX,v.translateY);let y=-(f/2)+g/2;p.forEach((t,i)=>{var a;let n=y+i*g;(null===(a=l.stroke)||void 0===a?void 0:a.enabled)&&(e.strokeStyle=l.stroke.color||"#000000",e.lineWidth=l.stroke.width||2,u>0?V(e,t,0,n,u,!0):e.strokeText(t,0,n)),l.text_shadow&&(e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=4,e.shadowOffsetX=0,e.shadowOffsetY=2),u>0?V(e,t,0,n,u,!1):e.fillText(t,0,n)}),e.restore()},[i,X,V,O,S]),W=(0,n.useCallback)((e,t)=>{var i,a;let n=S[t.id];if(!n)return;let l=t.position||{x:50,y:50,unit:"percent"},s=O(l),r=s.x-n.width/2-10,o=s.y-n.height/2-10,d=n.width+20,c=n.height+20;e.fillStyle="rgba(59, 130, 246, 0.1)",e.fillRect(r,o,d,c),e.strokeStyle="#3b82f6",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(r,o,d,c),e.setLineDash([]),L(r,o,d,c).forEach(t=>{e.fillStyle="#ffffff",e.fillRect(t.x-6,t.y-6,12,12),e.strokeStyle="#3b82f6",e.lineWidth=2,e.strokeRect(t.x-6,t.y-6,12,12)});let u=t.dimensions||{},m=u.width?u.width.toFixed(1):"auto";e.fillStyle="rgba(59, 130, 246, 0.9)",e.fillRect(r,o-25,180,20),e.fillStyle="#ffffff",e.font="12px Arial",e.textAlign="left",e.textBaseline="top",e.fillText("(".concat(null===(i=l.x)||void 0===i?void 0:i.toFixed(1),"%, ").concat(null===(a=l.y)||void 0===a?void 0:a.toFixed(1),"%) W:").concat(m,"%"),r+5,o-23)},[S,L,O]),K=(0,n.useCallback)((e,t)=>{let i=S[t.id];if(!i)return;let a=O(t.position||{x:50,y:50,unit:"percent"}),n=a.x-i.width/2-10,l=a.y-i.height/2-10,s=i.width+20,r=i.height+20;e.strokeStyle="#60a5fa",e.lineWidth=1,e.setLineDash([3,3]),e.strokeRect(n,l,s,r),e.setLineDash([])},[S,O]),H=(0,n.useCallback)(()=>{let e=x.current;if(!e)return;let a=e.getContext("2d");a.clearRect(0,0,e.width,e.height);let n=t.filter(e=>{var t,a;let n=(null===(t=e.timing)||void 0===t?void 0:t.start_time)||0,s=(null===(a=e.timing)||void 0===a?void 0:a.end_time)||l;return i>=n-.016&&i<=s+.016});n.sort((e,t)=>(e.layer_index||0)-(t.layer_index||0)),n.forEach(e=>{G(a,e)}),s&&S[s.id]&&W(a,s),k&&k.id!==(null==s?void 0:s.id)&&S[k.id]&&K(a,k)},[i,t,l,s,k,S,G,W,K]);(0,n.useEffect)(()=>{r&&H()},[r,H]);let J=e=>{let t=x.current;if(!t)return{x:0,y:0};let i=t.getBoundingClientRect(),a=m/i.width,n=h/i.height;return{x:(e.clientX-i.left)*a,y:(e.clientY-i.top)*n}},q=(e,a)=>{for(let n of t.filter(e=>{var t,a;let n=(null===(t=e.timing)||void 0===t?void 0:t.start_time)||0,s=(null===(a=e.timing)||void 0===a?void 0:a.end_time)||l;return i>=n-.016&&i<=s+.016}).sort((e,t)=>(t.layer_index||0)-(e.layer_index||0))){let t=S[n.id];if(!t)continue;let i=O(n.position||{x:50,y:50,unit:"percent"}),l=i.x-t.width/2-10,s=i.y-t.height/2-10,r=t.width+20,o=t.height+20;if(e>=l&&e<=l+r&&a>=s&&a<=s+o)return n}return null},$=(e,t,i)=>{let a=S[i.id];if(!a)return null;let n=O(i.position||{x:50,y:50,unit:"percent"}),l=n.x-a.width/2-10;for(let i of L(l,n.y-a.height/2-10,a.width+20,a.height+20))if(12>=Math.sqrt(Math.pow(e-i.x,2)+Math.pow(t-i.y,2)))return i;return null},ee=()=>{p(!1),g(!1),b(null)};return(0,a.jsx)("canvas",{ref:x,width:m,height:h,className:"absolute top-0 left-0 w-full h-full cursor-default",style:{display:r?"block":"none"},onMouseDown:e=>{let t=J(e);if(s){let e=$(t.x,t.y,s);if(e){var i;let a=O(s.position),n=S[s.id],l=s.dimensions||{};g(!0),b(e),w(t),N({x:a.x,y:a.y,fontSize:(null===(i=s.styling)||void 0===i?void 0:i.font_size)||48,width:(null==n?void 0:n.width)||200,height:(null==n?void 0:n.height)||100,widthPercent:l.width||((null==n?void 0:n.width)||200)/m*100,heightPercent:l.height||((null==n?void 0:n.height)||100)/h*100,percentX:s.position.x,percentY:s.position.y});return}}let a=q(t.x,t.y);if(a){o(a);let e=O(a.position);p(!0),w(t),N({x:e.x,y:e.y,percentX:a.position.x,percentY:a.position.y})}else o(null)},onMouseMove:e=>{let t=J(e),i=x.current;if(!i)return;if(f&&s&&y){let e=t.x-j.x,a=t.y-j.y;if(!S[s.id])return;let n=y.position,l=_.width,r=_.height;if(E){let t=(e+a)/2;l=Math.max(50,_.width+t),r=Math.max(20,_.height+t)}else n.includes("e")?l=Math.max(50,_.width+e):n.includes("w")&&(l=Math.max(50,_.width-e)),n.includes("s")?r=Math.max(20,_.height+a):n.includes("n")&&(r=Math.max(20,_.height-a));let o=l/m*100,c=r/h*100;d(s.id,{dimensions:{width:Math.round(100*o)/100,height:Math.round(100*c)/100,unit:"percent"}}),i.style.cursor=y.cursor;return}if(v&&s){let e=t.x-j.x,a=t.y-j.y,n=B({x:Math.max(0,Math.min(m,_.x+e)),y:Math.max(0,Math.min(h,_.y+a))});d(s.id,{position:{...s.position,...n}}),i.style.cursor="move";return}if(s){let e=$(t.x,t.y,s);if(e){i.style.cursor=e.cursor;return}}let a=q(t.x,t.y);C(a),i.style.cursor=a?"move":"default"},onMouseUp:ee,onMouseLeave:ee,"data-testid":"interactive-overlay-canvas"})}var D=i(74453),M=i(63124),I=i(6884),O=i(35931),B=i(75733),L=i(47019),F=i(24841),Z=i(98094),U=i(92513),V=i(14659);let Q=(0,i(78614).bR)();function Y(e){var t,i,l,r;let{template:m,onSave:v}=e,{toast:p}=(0,V.pm)(),f=(0,n.useRef)(null);(0,n.useRef)(null);let g=(0,n.useRef)(null),[y,j]=(0,n.useState)(!1),[w,_]=(0,n.useState)(0),[N,k]=(0,n.useState)(0),[C,T]=(0,n.useState)((null==m?void 0:m.text_overlays)||[]),[E,A]=(0,n.useState)(null),[Y,G]=(0,n.useState)(!0),[W,K]=(0,n.useState)(!1),[H,J]=(0,n.useState)("timeline"),[q,$]=(0,n.useState)(new Set),[ee,et]=(0,n.useState)(!1),[ei,ea]=(0,n.useState)("couple_names"),[en,el]=(0,n.useState)((null==m?void 0:null===(t=m.video_data)||void 0===t?void 0:t.aspect_ratio)||"16:9");(0,n.useEffect)(()=>{var e;T((null==m?void 0:m.text_overlays)||[]),el((null==m?void 0:null===(e=m.video_data)||void 0===e?void 0:e.aspect_ratio)||"16:9")},[m]);let es=async()=>{let e={bride_name:{label:"Bride's Name",placeholder:"Sarah"},groom_name:{label:"Groom's Name",placeholder:"Michael"},bride_first_name:{label:"Bride's First Name",placeholder:"Sarah"},groom_first_name:{label:"Groom's First Name",placeholder:"Michael"},couple_names:{label:"Couple Names",placeholder:"John & Jane"},event_date:{label:"Event Date (Day)",placeholder:"15"},event_date_full:{label:"Event Date (Full)",placeholder:"June 15, 2025"},event_month:{label:"Event Month",placeholder:"June"},event_year:{label:"Event Year",placeholder:"2025"},event_day:{label:"Event Day",placeholder:"Monday"},event_time:{label:"Event Time",placeholder:"3:00 PM"},venue:{label:"Venue",placeholder:"Grand Hotel"},venue_address:{label:"Venue Address",placeholder:"123 Main St"},city:{label:"City",placeholder:"New York"},welcome_message:{label:"Welcome Message",placeholder:"Welcome to Our Wedding"},description:{label:"Description",placeholder:"Join us for our special day"},countdown_days:{label:"Countdown Days",placeholder:"30 Days"},custom_text_1:{label:"Custom Text 1",placeholder:"Custom Text"},custom_text_2:{label:"Custom Text 2",placeholder:"Custom Text"},custom_text_3:{label:"Custom Text 3",placeholder:"Custom Text"},custom_text_4:{label:"Custom Text 4",placeholder:"Custom Text"},custom_text_5:{label:"Custom Text 5",placeholder:"Custom Text"}},t=e[ei]||e.couple_names,i={endpoint_key:ei,label:t.label,placeholder_text:t.placeholder,position:{x:50,y:50,alignment:"center",anchor_point:"center",unit:"percent"},dimensions:{width:50,height:null,unit:"percent"},timing:{start_time:0,end_time:N||10},styling:{font_family:"Playfair Display",font_size:72,font_weight:"bold",color:"#ffffff",text_align:"center",letter_spacing:2,line_height:1.2,text_shadow:"0 2px 4px rgba(0,0,0,0.3)",stroke:{enabled:!1,color:"#000000",width:2}},animation:{type:"fade-in",duration:1,easing:"ease-in-out",entrance:{type:"fade-in",duration:1,easing:"ease-in-out"},exit:{type:"fade-out",duration:1,easing:"ease-in-out"}},responsive:{mobile_font_size:48,mobile_position:{x:50,y:30,unit:"percent"}},layer_index:C.length};try{let e=localStorage.getItem("token"),a=await s.Z.post("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/overlays"),i,{headers:{Authorization:"Bearer ".concat(e)}});T(a.data.text_overlays),p({title:"Success",description:"".concat(t.label," overlay added successfully")})}catch(e){var a,n;console.error("Failed to add overlay:",e),p({title:"Error",description:(null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.detail)||"Failed to add overlay",variant:"destructive"})}},er=async(e,t)=>{if(q.has(e)){p({title:"Overlay Locked",description:"Unlock the overlay to make changes",variant:"destructive"});return}try{console.log("Updating overlay:",e,"with updates:",t),T(i=>i.map(i=>{if(i.id===e){var a,n,l,s,r,o;let e={...i};return t.styling&&(e.styling={...i.styling,...t.styling,stroke:t.styling.stroke?{...null===(a=i.styling)||void 0===a?void 0:a.stroke,...t.styling.stroke}:null===(n=i.styling)||void 0===n?void 0:n.stroke}),t.animation&&(e.animation={...i.animation,...t.animation,entrance:t.animation.entrance?{...null===(l=i.animation)||void 0===l?void 0:l.entrance,...t.animation.entrance}:null===(s=i.animation)||void 0===s?void 0:s.entrance,exit:t.animation.exit?{...null===(r=i.animation)||void 0===r?void 0:r.exit,...t.animation.exit}:null===(o=i.animation)||void 0===o?void 0:o.exit}),t.position&&(e.position={...i.position,...t.position}),t.dimensions&&(e.dimensions={...i.dimensions,...t.dimensions}),t.timing&&(e.timing={...i.timing,...t.timing}),Object.keys(t).forEach(i=>{["styling","animation","position","dimensions","timing"].includes(i)||(e[i]=t[i])}),e}return i})),(null==E?void 0:E.id)===e&&A(e=>{var i,a,n,l,s,r;let o={...e};return t.styling&&(o.styling={...e.styling,...t.styling,stroke:t.styling.stroke?{...null===(i=e.styling)||void 0===i?void 0:i.stroke,...t.styling.stroke}:null===(a=e.styling)||void 0===a?void 0:a.stroke}),t.animation&&(o.animation={...e.animation,...t.animation,entrance:t.animation.entrance?{...null===(n=e.animation)||void 0===n?void 0:n.entrance,...t.animation.entrance}:null===(l=e.animation)||void 0===l?void 0:l.entrance,exit:t.animation.exit?{...null===(s=e.animation)||void 0===s?void 0:s.exit,...t.animation.exit}:null===(r=e.animation)||void 0===r?void 0:r.exit}),t.position&&(o.position={...e.position,...t.position}),t.dimensions&&(o.dimensions={...e.dimensions,...t.dimensions}),t.timing&&(o.timing={...e.timing,...t.timing}),Object.keys(t).forEach(e=>{["styling","animation","position","dimensions","timing"].includes(e)||(o[e]=t[e])}),o});let i=localStorage.getItem("token"),a=await s.Z.put("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/overlays/").concat(e),t,{headers:{Authorization:"Bearer ".concat(i)}});console.log("Update response:",a.data),console.log("Returned overlays:",a.data.text_overlays);let n=a.data.text_overlays;if(T(n),(null==E?void 0:E.id)===e){let t=n.find(t=>t.id===e);t&&(console.log("Updated overlay data from server:",JSON.stringify(t.styling,null,2)),console.log("Updated overlay animation from server:",JSON.stringify(t.animation,null,2)),A(t))}(!t.position||Object.keys(t).length>1)&&p({title:"Success",description:"Overlay updated successfully"})}catch(t){var i,a,n,l;if(console.error("Failed to update overlay:",t),console.error("Error details:",null===(i=t.response)||void 0===i?void 0:i.data),T((null==m?void 0:m.text_overlays)||[]),(null==E?void 0:E.id)===e){let t=null==m?void 0:null===(l=m.text_overlays)||void 0===l?void 0:l.find(t=>t.id===e);t&&A(t)}throw p({title:"Error",description:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.detail)||"Failed to update overlay",variant:"destructive"}),t}},eo=async e=>{if(confirm("Are you sure you want to delete this overlay?"))try{let t=localStorage.getItem("token"),i=await s.Z.delete("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/overlays/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});T(i.data.text_overlays),A(null),p({title:"Success",description:"Overlay deleted"})}catch(e){console.error("Failed to delete overlay:",e),p({title:"Error",description:"Failed to delete overlay",variant:"destructive"})}},ed=async e=>{try{let t=localStorage.getItem("token");await s.Z.put("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/overlays/reorder"),e,{headers:{Authorization:"Bearer ".concat(t)}});let i=e.map(e=>C.find(t=>t.id===e)).filter(Boolean);T(i)}catch(e){console.error("Failed to reorder overlays:",e)}},ec=async()=>{K(!0);try{v&&await v(),p({title:"Success",description:"Template saved successfully"})}catch(e){p({title:"Error",description:"Failed to save template",variant:"destructive"})}finally{K(!1)}},eu=async()=>{if(!E)return;let e={...E,position:{...E.position,x:E.position.x+50,y:E.position.y+50},label:"".concat(E.label," (Copy)"),layer_index:C.length};delete e.id;try{let t=localStorage.getItem("token"),i=await s.Z.post("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/overlays"),e,{headers:{Authorization:"Bearer ".concat(t)}});T(i.data.text_overlays),p({title:"Success",description:"Overlay duplicated successfully"})}catch(e){console.error("Failed to duplicate overlay:",e),p({title:"Error",description:"Failed to duplicate overlay",variant:"destructive"})}},em=()=>{E&&$(e=>{let t=new Set(e);return t.has(E.id)?(t.delete(E.id),p({title:"Overlay Unlocked",description:"You can now edit this overlay"})):(t.add(E.id),p({title:"Overlay Locked",description:"This overlay is now protected from changes"})),t})},eh=()=>{E&&eo(E.id)},ex=async e=>{if(confirm("Changing aspect ratio from ".concat(en," to ").concat(e," may affect overlay positioning. Continue?")))try{let t=localStorage.getItem("token");await s.Z.put("".concat(Q,"/api/admin/video-templates/").concat(m.id,"/aspect-ratio"),{aspect_ratio:e},{headers:{Authorization:"Bearer ".concat(t)}}),el(e),p({title:"Success",description:"Aspect ratio changed to ".concat(e,". Please review overlay positions.")}),window.location.reload()}catch(e){var t,i;console.error("Failed to change aspect ratio:",e),p({title:"Error",description:(null===(i=e.response)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.detail)||"Failed to change aspect ratio",variant:"destructive"})}};return(0,n.useEffect)(()=>{let e=e=>{("Delete"===e.key||"Backspace"===e.key)&&E&&(e.preventDefault(),eh()),(e.ctrlKey||e.metaKey)&&"d"===e.key&&E&&(e.preventDefault(),eu()),(e.ctrlKey||e.metaKey)&&"l"===e.key&&E&&(e.preventDefault(),em())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[E]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(d.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,a.jsx)(x.C,{className:"ml-2",variant:"default",children:"In Progress"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:C.length})," overlays configured"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pl-4 border-l",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Aspect Ratio:"}),(0,a.jsxs)(u.Ph,{value:en,onValueChange:ex,children:[(0,a.jsx)(u.i4,{className:"w-[120px]","data-testid":"aspect-ratio-select",children:(0,a.jsx)(u.ki,{})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"16:9",children:"16:9 (Landscape)"}),(0,a.jsx)(u.Ql,{value:"9:16",children:"9:16 (Portrait)"})]})]})]}),E&&(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-4 pl-4 border-l",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Selected:"}),(0,a.jsx)(x.C,{variant:"secondary",children:E.label||E.endpoint_key}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:em,"data-testid":"toggle-lock-btn",children:[q.has(E.id)?(0,a.jsx)(D.Z,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-1"}),q.has(E.id)?"Unlock":"Lock"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:eu,"data-testid":"duplicate-overlay-btn",children:[(0,a.jsx)(I.Z,{className:"w-4 h-4 mr-1"}),"Duplicate"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:eh,className:"text-red-600 hover:text-red-700","data-testid":"delete-selected-btn",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>J("timeline"===H?"list":"timeline"),"data-testid":"toggle-editor-mode-btn",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"timeline"===H?"List View":"Timeline View"]})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,a.jsxs)(d.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Video Preview"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>et(!ee),"data-testid":"toggle-grid-snap-btn",className:ee?"bg-blue-100":"",children:["Grid Snap ",ee?"ON":"OFF"]}),(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>G(!Y),"data-testid":"toggle-overlays-btn",children:[Y?(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(L.Z,{className:"w-4 h-4 mr-1"}),Y?"Hide":"Show"," Overlays"]}),(0,a.jsxs)(c.z,{size:"sm",onClick:()=>j(!y),"data-testid":"play-pause-btn",children:[y?(0,a.jsx)(F.Z,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-1"}),y?"Pause":"Play"]})]})]}),(0,a.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden ".concat("9:16"===en?"aspect-[9/16] max-w-md mx-auto":"aspect-video"),ref:g,children:[(0,a.jsx)(o(),{ref:f,url:null==m?void 0:null===(i=m.video_data)||void 0===i?void 0:i.original_url,playing:y,controls:!1,width:"100%",height:"100%",onProgress:e=>{let{playedSeconds:t}=e;return _(t)},onDuration:k,onPlay:()=>j(!0),onPause:()=>j(!1),config:{file:{attributes:{controlsList:"nodownload",disablePictureInPicture:!0}}}}),(0,a.jsx)(P,{overlays:C,currentTime:w,duration:N,selectedOverlay:E,showOverlays:Y,onSelectOverlay:A,onUpdateOverlay:er,containerRef:g,videoResolution:{width:(null==m?void 0:null===(l=m.video_data)||void 0===l?void 0:l.width)||1920,height:(null==m?void 0:null===(r=m.video_data)||void 0===r?void 0:r.height)||1080}})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsx)("span",{children:X(w)}),(0,a.jsx)("span",{children:X(N)})]}),(0,a.jsx)("input",{type:"range",min:0,max:N||100,value:w,onChange:e=>{let t=parseFloat(e.target.value);_(t),f.current&&f.current.seekTo(t)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer","data-testid":"timeline-slider"})]})]}),(0,a.jsxs)(d.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-2",children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Text Overlays (",C.length,")"]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsxs)(u.Ph,{value:ei,onValueChange:ea,children:[(0,a.jsx)(u.i4,{className:"w-[180px]","data-testid":"overlay-type-select",children:(0,a.jsx)(u.ki,{placeholder:"Select overlay type"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"bride_name",children:"Bride's Name"}),(0,a.jsx)(u.Ql,{value:"groom_name",children:"Groom's Name"}),(0,a.jsx)(u.Ql,{value:"bride_first_name",children:"Bride's First Name"}),(0,a.jsx)(u.Ql,{value:"groom_first_name",children:"Groom's First Name"}),(0,a.jsx)(u.Ql,{value:"couple_names",children:"Couple Names"}),(0,a.jsx)(u.Ql,{value:"event_date",children:"Event Date (Day)"}),(0,a.jsx)(u.Ql,{value:"event_date_full",children:"Event Date (Full)"}),(0,a.jsx)(u.Ql,{value:"event_month",children:"Event Month"}),(0,a.jsx)(u.Ql,{value:"event_year",children:"Event Year"}),(0,a.jsx)(u.Ql,{value:"event_day",children:"Event Day"}),(0,a.jsx)(u.Ql,{value:"event_time",children:"Event Time"}),(0,a.jsx)(u.Ql,{value:"venue",children:"Venue"}),(0,a.jsx)(u.Ql,{value:"venue_address",children:"Venue Address"}),(0,a.jsx)(u.Ql,{value:"city",children:"City"}),(0,a.jsx)(u.Ql,{value:"welcome_message",children:"Welcome Message"}),(0,a.jsx)(u.Ql,{value:"description",children:"Description"}),(0,a.jsx)(u.Ql,{value:"countdown_days",children:"Countdown Days"}),(0,a.jsx)(u.Ql,{value:"custom_text_1",children:"Custom Text 1"}),(0,a.jsx)(u.Ql,{value:"custom_text_2",children:"Custom Text 2"}),(0,a.jsx)(u.Ql,{value:"custom_text_3",children:"Custom Text 3"}),(0,a.jsx)(u.Ql,{value:"custom_text_4",children:"Custom Text 4"}),(0,a.jsx)(u.Ql,{value:"custom_text_5",children:"Custom Text 5"})]})]}),(0,a.jsxs)(c.z,{size:"sm",onClick:es,"data-testid":"add-overlay-btn",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 mr-1"}),"Add Overlay"]})]})]}),"timeline"===H?(0,a.jsx)(z,{overlays:C,duration:N,currentTime:w,selectedOverlay:E,onSelectOverlay:A,onUpdateOverlay:er,onDeleteOverlay:eo,onReorder:ed,onSeek:e=>{_(e),f.current&&f.current.seekTo(e)}}):(0,a.jsx)(h.x,{className:"h-64",children:0===C.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No overlays added yet"}):(0,a.jsx)("div",{className:"space-y-2",children:C.map((e,t)=>{var i,n;return(0,a.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat((null==E?void 0:E.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>A(e),"data-testid":"overlay-item-".concat(t),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.label||e.endpoint_key}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[X((null===(i=e.timing)||void 0===i?void 0:i.start_time)||0)," - ",X((null===(n=e.timing)||void 0===n?void 0:n.end_time)||0)]})]}),(0,a.jsx)(c.z,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),eo(e.id)},className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(R.Z,{className:"w-4 h-4"})})]})},e.id||t)})})})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(d.Zb,{className:"p-4 sticky top-6",children:E?(0,a.jsx)(S,{overlay:E,duration:N,currentTime:w,onUpdate:e=>er(E.id,e),onSeek:e=>{_(e),f.current&&f.current.seekTo(e)}}):(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500",children:"Select an overlay to configure"})})})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(d.Zb,{className:"p-4 flex-1 mr-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm mb-2",children:"Keyboard Shortcuts"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Delete"})," - Delete selected overlay"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Ctrl/Cmd + D"})," - Duplicate overlay"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Arrow Keys"})," - Move overlay (1px)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Shift + Arrow"})," - Move overlay (10px)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Ctrl/Cmd + L"})," - Lock/Unlock overlay"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Shift + Drag"})," - Proportional resize"]})]})]}),(0,a.jsxs)(c.z,{onClick:ec,disabled:W,size:"lg","data-testid":"save-template-btn",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),W?"Saving...":"Save Template"]})]})]})}function X(e){return!e||isNaN(e)?"0:00":"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"))}var G=i(95137),W=i(6657);function K(){let e=(0,l.useRouter)(),t=(0,l.useParams)(),{toast:i}=(0,V.pm)(),[s,r]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=document.createElement("link");return e.href="https://fonts.googleapis.com/css2?".concat(["Playfair+Display:wght@400;600;700","Montserrat:wght@400;600;700","Roboto:wght@400;700","Open+Sans:wght@400;700","Lato:wght@400;700","Caveat:wght@400;700","Bebas+Neue","Rozha+One","Pinyon+Script","Great+Vibes","Cinzel:wght@400;600;700"].map(e=>"family=".concat(e)).join("&"),"&display=swap"),e.rel="stylesheet",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,n.useEffect)(()=>{t.id&&u()},[t.id]);let u=async()=>{let a=localStorage.getItem("token");if(!a){e.push("/login");return}try{d(!0);let e=await W.default.get("/api/video-templates/".concat(t.id),{headers:{Authorization:"Bearer ".concat(a)}});r(e.data)}catch(t){console.error("Failed to load template:",t),i({title:"Error",description:"Failed to load template",variant:"destructive"}),e.push("/admin/video-templates")}finally{d(!1)}},m=async()=>{try{i({title:"Success",description:"Template saved successfully"}),await new Promise(e=>setTimeout(e,500)),e.push("/admin/video-templates")}catch(e){console.error("Error during save:",e),i({title:"Error",description:"Failed to save template",variant:"destructive"})}};return o?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading template..."})]})}):s?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"border-b bg-white px-6 py-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)(c.z,{variant:"ghost",onClick:()=>e.push("/admin/video-templates"),className:"mb-2","data-testid":"back-to-templates-btn",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2"}),"Back to Templates"]}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:s.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:s.description})]})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(Y,{template:s,onSave:m})})]}):null}},79004:function(e,t,i){"use strict";i.d(t,{C:function(){return r}});var a=i(57437);i(2265);var n=i(13027),l=i(77700);let s=(0,n.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function r(e){let{className:t,variant:i,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(s({variant:i}),t),...n})}},56360:function(e,t,i){"use strict";i.d(t,{z:function(){return d}});var a=i(57437),n=i(2265),l=i(71538),s=i(13027),r=i(77700);let o=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:i,variant:n,size:s,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,a.jsx)(u,{className:(0,r.cn)(o({variant:n,size:s,className:i})),ref:t,...c})});d.displayName="Button"},10273:function(e,t,i){"use strict";i.d(t,{Ol:function(){return r},SZ:function(){return d},Zb:function(){return s},aY:function(){return c},eW:function(){return u},ll:function(){return o}});var a=i(57437),n=i(2265),l=i(77700);let s=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",i),...n})});s.displayName="Card";let r=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",i),...n})});r.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("font-semibold leading-none tracking-tight",i),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",i),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",i),...n})});c.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",i),...n})});u.displayName="CardFooter"},92404:function(e,t,i){"use strict";i.d(t,{I:function(){return s}});var a=i(57437),n=i(2265),l=i(77700);let s=n.forwardRef((e,t)=>{let{className:i,type:n,...s}=e;return(0,a.jsx)("input",{type:n,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:t,...s})});s.displayName="Input"},10464:function(e,t,i){"use strict";i.d(t,{_:function(){return d}});var a=i(57437),n=i(2265),l=i(38837),s=i(13027),r=i(77700);let o=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.f,{ref:t,className:(0,r.cn)(o(),i),...n})});d.displayName=l.f.displayName},25797:function(e,t,i){"use strict";i.d(t,{B:function(){return o},x:function(){return r}});var a=i(57437),n=i(2265),l=i(80023),s=i(77700);let r=n.forwardRef((e,t)=>{let{className:i,children:n,...r}=e;return(0,a.jsxs)(l.fC,{ref:t,className:(0,s.cn)("relative overflow-hidden",i),...r,children:[(0,a.jsx)(l.l_,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(o,{}),(0,a.jsx)(l.Ns,{})]})});r.displayName=l.fC.displayName;let o=n.forwardRef((e,t)=>{let{className:i,orientation:n="vertical",...r}=e;return(0,a.jsx)(l.gb,{ref:t,orientation:n,className:(0,s.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",i),...r,children:(0,a.jsx)(l.q4,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=l.gb.displayName},46260:function(e,t,i){"use strict";i.d(t,{Bw:function(){return v},Ph:function(){return c},Ql:function(){return p},i4:function(){return m},ki:function(){return u}});var a=i(57437),n=i(2265),l=i(89363),s=i(42421),r=i(14392),o=i(22468),d=i(77700);let c=l.fC;l.ZA;let u=l.B4,m=n.forwardRef((e,t)=>{let{className:i,children:n,...r}=e;return(0,a.jsxs)(l.xz,{ref:t,className:(0,d.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap bg-transparent px-0 py-0 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-0 focus:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 [&>span]:border-none [&>span]:outline-none [&>span]:focus:border-none [&>span]:focus:outline-none [&>span]:focus:ring-0 [&>span]:focus:ring-offset-0 [&>span]:!border-0 [&>span]:!outline-none [&>span]:!ring-0",i),...r,children:[n,(0,a.jsx)(l.JO,{asChild:!0,children:(0,a.jsx)(s.Z,{className:"h-4 w-4 opacity-50 ml-1"})})]})});m.displayName=l.xz.displayName;let h=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",i),...n,children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})})});h.displayName=l.u_.displayName;let x=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",i),...n,children:(0,a.jsx)(s.Z,{className:"h-4 w-4"})})});x.displayName=l.$G.displayName;let v=n.forwardRef((e,t)=>{let{className:i,children:n,position:s="popper",...r}=e;return(0,a.jsx)(l.h_,{children:(0,a.jsxs)(l.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:s,...r,children:[(0,a.jsx)(h,{}),(0,a.jsx)(l.l_,{className:(0,d.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(x,{})]})})});v.displayName=l.VY.displayName,n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",i),...n})}).displayName=l.__.displayName;let p=n.forwardRef((e,t)=>{let{className:i,children:n,...s}=e;return(0,a.jsxs)(l.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none border-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>span]:border-none [&>span]:outline-none [&>span]:!border-0 [&>span]:!outline-none",i),...s,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.wU,{children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(l.eT,{children:n})]})});p.displayName=l.ck.displayName,n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",i),...n})}).displayName=l.Z0.displayName},85398:function(e,t,i){"use strict";i.d(t,{i:function(){return r}});var a=i(57437),n=i(2265),l=i(67553),s=i(77700);let r=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsxs)(l.fC,{ref:t,className:(0,s.cn)("relative flex w-full touch-none select-none items-center",i),...n,children:[(0,a.jsx)(l.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(l.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(l.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});r.displayName=l.fC.displayName},80492:function(e,t,i){"use strict";i.d(t,{r:function(){return r}});var a=i(57437),n=i(2265),l=i(9646),s=i(77700);let r=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.fC,{className:(0,s.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...n,ref:t,children:(0,a.jsx)(l.bU,{className:(0,s.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});r.displayName=l.fC.displayName},65236:function(e,t,i){"use strict";i.d(t,{SP:function(){return d},dr:function(){return o},mQ:function(){return r},nU:function(){return c}});var a=i(57437),n=i(2265),l=i(62447),s=i(77700);let r=l.fC,o=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,s.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",i),...n})});o.displayName=l.aV.displayName;let d=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.xz,{ref:t,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",i),...n})});d.displayName=l.xz.displayName;let c=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...n})});c.displayName=l.VY.displayName},14659:function(e,t,i){"use strict";i.d(t,{pm:function(){return m}});var a=i(2265);let n=0,l=new Map,s=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=t;return i?s(i):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=r(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,i=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:i});return c({type:"ADD_TOAST",toast:{...t,id:i,open:!0,onOpenChange:e=>{e||a()}}}),{id:i,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:i}})}}function m(){let[e,t]=a.useState(d);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},6657:function(e,t,i){"use strict";i.r(t);var a=i(38472),n=i(78614);(0,n.ww)(),console.log("API Base URL:",(0,n.bR)());let l=a.Z.create({baseURL:(0,n.bR)(),headers:{"Content-Type":"application/json"},timeout:n.ZP.API.TIMEOUT});l.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),l.interceptors.response.use(e=>e,async e=>{var t,i,a,s,r,o,d;let c=e.config;if(console.error("API Error:",e),"ECONNABORTED"===e.code||"Network Error"===e.message){if(c.__retryCount||(c.__retryCount=0),c.__retryCount<n.ZP.API.RETRY_ATTEMPTS)return c.__retryCount+=1,console.warn("Retrying request (".concat(c.__retryCount,"/").concat(n.ZP.API.RETRY_ATTEMPTS,")...")),await new Promise(e=>setTimeout(e,n.ZP.API.RETRY_DELAY*c.__retryCount)),l(c);console.error("Request timeout after retries - API might be down")}if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("❌ Authentication failed - token expired or invalid"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(s=window.toast)||void 0===s||s.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true"),(null===(i=e.response)||void 0===i?void 0:i.status)===403){console.error("❌ Access forbidden - you may not have permission or your session expired");let t=(null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"";(t.toLowerCase().includes("not authorized")||t.toLowerCase().includes("permission"))&&(console.warn("⚠️ Token may be expired - redirecting to login"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(d=window.toast)||void 0===d||d.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true")}return(null===(a=e.response)||void 0===a?void 0:a.status)===404&&console.error("Resource not found - check API endpoint"),Promise.reject(e)}),t.default=l},78614:function(e,t,i){"use strict";i.d(t,{bR:function(){return s},ww:function(){return r}});var a=i(20357);let n=()=>{{let e=window.location.hostname;return e.includes("vercel.app")||e.includes("wedlive.vercel.app")}},l={API:{BASE_URL:(()=>{let e=a.env.NEXT_PUBLIC_BACKEND_URL||a.env.REACT_APP_BACKEND_URL||a.env.NEXT_PUBLIC_API_URL;if(e)return e;{let e=window.location.hostname;if(e.includes("emergentagent.com")||e.includes("preview.emergentagent.com"))return window.location.origin;if(e.includes("vercel.app")||e.includes("wedlive.vercel.app"))return"https://wedlive.onrender.com";e.includes("localhost")||e.includes("127.0.0.1")}return"http://localhost:8001"})(),TIMEOUT:3e5,RETRY_ATTEMPTS:2,RETRY_DELAY:1e3},MEDIA:{PROXY_ENDPOINT:"/api/media/telegram-proxy/photos/",SUPPORTED_FORMATS:["jpg","jpeg","png","webp"],MAX_FILE_SIZE:10485760},IMAGE:{MAX_RETRIES:2,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3,LOADING_PLACEHOLDER:"/images/placeholder.jpg"}},s=()=>l.API.BASE_URL,r=()=>{let e=s(),t=e.includes("localhost"),i=n();return console.log("\uD83D\uDD27 Configuration Validation:",{apiBaseUrl:e,environment:i?"production":"development",isLocal:t,mediaProxy:l.MEDIA.PROXY_ENDPOINT}),i&&t&&(console.error("❌ ERROR: Production frontend using localhost backend URL!"),console.error("Update NEXT_PUBLIC_API_URL in Vercel environment variables to: https://wedlive.onrender.com")),e.includes("8000")&&console.warn("⚠️ WARNING: API base URL is using port 8000, expected 8001 for local or 443 for production"),!0};t.ZP=l},77700:function(e,t,i){"use strict";i.d(t,{cn:function(){return l}});var a=i(44839),n=i(96164);function l(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,n.m6)((0,a.W)(t))}}},function(e){e.O(0,[9767,4868,2889,2151,7662,40,7553,1924,8413,2971,7023,1744],function(){return e(e.s=54176)}),_N_E=e.O()}]);