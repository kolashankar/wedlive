(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2858],{75337:function(e,a,t){Promise.resolve().then(t.bind(t,73334))},73334:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return F}});var s=t(57437),r=t(2265),l=t(10273),o=t(56360),n=t(79004),i=t(3274),c=t(95137),d=t(76780),m=t(74697),g=t(22468),h=t(58184),u=t(39451),p=t(24863),x=t(10883),f=t(16463),b=t(38472),v=t(85398),y=t(91773),k=t(99913),w=t(21577),j=t(38296),N=t(24258),T=t(39348),C=t(3751),S=t(54775),_=t(75733),P=t(59061),B=t(82616),R=t(44828),I=t(92095);function E(e){let{imageUrl:a,onBorderSave:c,onClose:d,assetType:g="border",className:h="",borderId:p=null,previewPhotoUrl:x=null}=e,f=(0,r.useRef)(null),b=(0,r.useRef)(null),E=(0,r.useRef)(null),A=(0,r.useRef)(null),F=(0,r.useRef)(null),[z,M]=(0,r.useState)(!1),[D,O]=(0,r.useState)("pen"),[U,Z]=(0,r.useState)([]),[L,G]=(0,r.useState)([]),[Y,X]=(0,r.useState)(null),[W,H]=(0,r.useState)(1),[V,q]=(0,r.useState)({x:0,y:0}),[K,J]=(0,r.useState)(!0),[$,Q]=(0,r.useState)([.7]),[ee,ea]=(0,r.useState)([]),[et,es]=(0,r.useState)(-1),[er,el]=(0,r.useState)(null),[eo,en]=(0,r.useState)(!1),[ei,ec]=(0,r.useState)([]),[ed,em]=(0,r.useState)("detect"),[eg,eh]=(0,r.useState)([50]),[eu,ep]=(0,r.useState)([5]),[ex,ef]=(0,r.useState)([10]),[eb,ev]=(0,r.useState)([5]),[ey,ek]=(0,r.useState)(null),[ew,ej]=(0,r.useState)(!1),[eN,eT]=(0,r.useState)(!1),[eC,eS]=(0,r.useState)([]),[e_,eP]=(0,r.useState)(null),[eB,eR]=(0,r.useState)(!0),[eI,eE]=(0,r.useState)("auto"),[eA,eF]=(0,r.useState)("#00ff00"),[ez,eM]=(0,r.useState)([50]),[eD,eO]=(0,r.useState)([2]),[eU,eZ]=(0,r.useState)([50]),[eL,eG]=(0,r.useState)([20]),[eY,eX]=(0,r.useState)(null),[eW,eH]=(0,r.useState)(null),[eV,eq]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(a){console.log("Loading image from URL:",a);let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{console.log("Image loaded successfully, dimensions:",e.width,"x",e.height),el(e),an(e),eK(e)},e.onerror=e=>{console.error("Error loading image:",e),en(!1)},e.src=a}else console.log("No imageUrl provided")},[a]),(0,r.useEffect)(()=>{if(er&&eB&&A.current){console.log("Auto-running chroma key processing for loaded image");let e=setTimeout(()=>{ae()},100);return()=>clearTimeout(e)}},[er,eB,A.current]);let eK=(0,r.useCallback)(e=>{console.log("Task 1: Initializing finalCanvas - Standardized Pipeline");let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let t=a.getContext("2d");return A.current=a,F.current=t,console.log("Task 1: finalCanvas initialized with dimensions:",e.width,"x",e.height),console.log("Task 1: Standardized pipeline ready for composition"),a},[]),eJ=(0,r.useCallback)(async e=>{let{transparentImage:a,maskPath:t,borderOverlay:s}=e;console.log("Task 1: Starting standardized pipeline composition");let r=A.current,l=F.current;if(!r||!l)return console.error("Task 1: finalCanvas not initialized"),null;if(l.clearRect(0,0,r.width,r.height),t&&t.length>0){console.log("Task 3: Applying mask clipping BEFORE drawing transparent image");let e=e$(t);e?(eQ(l,e),a&&(console.log("Task 3: Drawing transparent image WITHIN mask bounds"),l.drawImage(a,0,0)),e0(l)):a&&(console.log("Task 3: Mask creation failed, drawing transparent image without clipping"),l.drawImage(a,0,0))}else a&&(console.log("Task 3: No mask path available, drawing transparent image without clipping"),l.drawImage(a,0,0));return s?(console.log("Task 4: Overlaying floral frame as non-masked layer"),l.drawImage(s,0,0),console.log("Task 4: Floral frame overlay completed"),console.log("Task 4: Frame is visible outside mask, center remains transparent")):console.log("Task 4: No floral frame overlay provided"),console.log("Task 1: Pipeline composition completed"),r},[]),e$=(0,r.useCallback)(e=>{if(console.log("Task 2: Converting drawn border to Canvas Path2D mask"),!e||e.length<3)return console.error("Task 2: Insufficient points for mask path"),null;let a=new Path2D;a.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)a.lineTo(e[t].x,e[t].y);return a.closePath(),console.log("Task 2: Mask path created with",e.length,"points"),console.log("Task 2: Path is closed and ready for clipping"),a},[]),eQ=(0,r.useCallback)((e,a)=>(console.log("Task 2: Applying mask clipping to canvas context"),a)?(e.save(),e.beginPath(),e.clip(a),console.log("Task 2: Mask clipping applied successfully"),console.log("Task 2: Canvas context is now clipped to mask path"),!0):(console.error("Task 2: No mask path provided for clipping"),!1),[]),e0=(0,r.useCallback)(e=>{console.log("Task 2: Restoring canvas context after clipping"),e.restore(),console.log("Task 2: Canvas context restored")},[]);(0,r.useCallback)(()=>{let e="draw"===ed&&U.length>3?U:ei;return console.log("Task 2: Final border points:",e.length,"points from mode:",ed),e},[ed,U,ei]),(0,r.useCallback)(async e=>{if(console.log("Task 3: Processing chroma key result with mask application"),!await ae()||!eW)return console.error("Task 3: No chroma key processed image available"),null;console.log("Task 3: Chroma key processing completed, applying mask");let a=await eJ({transparentImage:eW,maskPath:e,borderOverlay:null});return a&&(console.log("Task 3: Mask successfully applied to transparent image"),console.log("Task 3: Final canvas dimensions:",a.width,"x",a.height)),a},[eW,eJ]);let e2=(0,r.useCallback)(async()=>(console.log("Task 4: Loading floral frame overlay"),er)?(console.log("Task 4: Using original image as floral frame overlay"),console.log("Task 4: Frame dimensions:",er.width,"x",er.height),er):(console.error("Task 4: No original image available for floral frame"),null),[er]);(0,r.useCallback)(async e=>{console.log("Task 4: Starting complete composition with floral frame"),await e2();let a=await eJ({transparentImage:eW,maskPath:e,borderOverlay:null});return a&&(console.log("Task 4: Complete composition with floral frame completed"),console.log("Task 4: Final result has transparent center + visible floral border")),a},[e2,eW,eJ]);let e1=(0,r.useCallback)(async e=>(console.log("Task 5: Exporting PNG with alpha transparency"),e)?new Promise((a,t)=>{try{console.log("Task 5: Converting canvas to PNG blob with alpha"),console.log("Task 5: Canvas dimensions:",e.width,"x",e.height),e.toBlob(s=>{if(!s){console.error("Task 5: Failed to create PNG blob"),t(Error("Failed to create PNG blob"));return}if("image/png"!==s.type){console.error("Task 5: Export is not PNG format:",s.type),t(Error("Export is not PNG format"));return}console.log("Task 5: PNG export successful"),console.log("Task 5: File size:",(s.size/1024/1024).toFixed(2),"MB"),console.log("Task 5: Alpha transparency preserved");let r=URL.createObjectURL(s);a({blob:s,url:r,canvas:e,dimensions:{width:e.width,height:e.height},format:"PNG",hasAlpha:!0,quality:1})},"image/png",1)}catch(e){console.error("Task 5: Error during PNG export:",e),t(e)}}):(console.error("Task 5: No canvas provided for export"),null),[]),e4=(0,r.useCallback)(async e=>{console.log("Task 5: Exporting final composition - masked transparent image only");try{if(!eW){console.error("Save blocked: No processed transparent image available"),setError("Please process background removal first before saving the border");return}console.log("Save validation passed: Processed transparent image available"),eB&&(console.log("Task 5: Confirming chroma key processing before export"),await new Promise(e=>{let a=()=>{eW?(console.log("Task 5: Processed image confirmed ready for export"),e()):(ae(),setTimeout(a,200))};a()}));let a=await eJ({transparentImage:eW,maskPath:e,borderOverlay:null});if(!a)return console.error("Task 5: Failed to create masked composition"),null;let t=await e1(a);return t&&(console.log("Task 5: Masked transparent image exported successfully"),console.log("Task 5: Ready for save/upload - no floral frame")),t}catch(e){return console.error("Task 5: Error exporting masked composition:",e),null}},[eW,eJ,e1]),e5=(0,r.useCallback)((e,a)=>{console.log("Task 7: Creating mask metadata for dynamic photo reuse");let t=e3(e),s={maskPath:e,maskBounds:t,pointCount:e.length,feather:eu[0],shadowBlur:ex[0],shadowOffset:eb[0],chromaKeySettings:eB?{enabled:!0,mode:eI,keyColor:"auto"===eI?eY:eA,tolerance:ez[0],edgeFeather:eD[0],edgeSmoothness:eU[0],spillSuppression:eL[0]}:null,exportInfo:a?{dimensions:a.dimensions,format:a.format,hasAlpha:a.hasAlpha,quality:a.quality,timestamp:new Date().toISOString()}:null,autoFitMetadata:{maskArea:ag(e),aspectRatio:t?(t.width/t.height).toFixed(2):"1.0",centerPoint:am(e),scalingStrategy:"contain",padding:10},templateInfo:{assetType:g,mode:ed,createdAt:new Date().toISOString(),version:"1.0.0",pipeline:"chroma_key_mask_frame_png"}};return console.log("Task 7: Mask metadata created"),console.log("Task 7: Mask bounds:",t),console.log("Task 7: Point count:",e.length),s},[eu,ex,eb,eB,eI,eY,eA,ez,eD,eU,eL,g,ed]),e3=(0,r.useCallback)(e=>{if(console.log("Task 7: Calculating mask bounds for auto-fitting"),!e||0===e.length)return console.error("Task 7: No border points provided for bounds calculation"),null;let a=1/0,t=1/0,s=-1/0,r=-1/0;e.forEach(e=>{a=Math.min(a,e.x),t=Math.min(t,e.y),s=Math.max(s,e.x),r=Math.max(r,e.y)});let l={x:a,y:t,width:s-a,height:r-t,centerX:a+(s-a)/2,centerY:t+(r-t)/2};return console.log("Task 7: Mask bounds calculated:",l),l},[]),e7=(0,r.useCallback)(async(e,a)=>{console.log("Task 7: Persisting mask metadata for reuse");try{let s=e5(e,a);if(p){console.log("Task 7: Saving mask metadata to backend API");let e=(await t.e(6657).then(t.bind(t,6657))).default;await e.put("/api/admin/theme-assets/borders/".concat(p,"/mask-metadata"),s),console.log("Task 7: Backend metadata save completed")}try{let e="wedlive-mask-metadata-".concat(p||"temp");localStorage.setItem(e,JSON.stringify(s)),console.log("Task 7: LocalStorage backup completed")}catch(e){console.warn("Task 7: LocalStorage backup failed:",e)}try{let e="wedlive-mask-session-".concat(Date.now());sessionStorage.setItem(e,JSON.stringify(s)),console.log("Task 7: SessionStorage backup completed")}catch(e){console.warn("Task 7: SessionStorage backup failed:",e)}return console.log("Task 7: Mask metadata persistence completed"),console.log("Task 7: Metadata size:",JSON.stringify(s).length,"characters"),s}catch(e){return console.error("Task 7: Error persisting mask metadata:",e),null}},[p,e5]),e6=(0,r.useCallback)((e,a)=>{if(console.log("Task 8: Calculating auto-fit transform for photo"),!e||!a||!a.maskBounds)return console.error("Task 8: Missing photo image or mask metadata"),null;let{maskBounds:t,autoFitMetadata:s}=a,r=s.padding||10,l=t.width-2*r,o=t.height-2*r,n=l/e.width,i=o/e.height,c,d=0;switch(s.scalingStrategy){case"cover":c=Math.max(n,i);break;case"fill":c=n;break;default:c=Math.min(n,i)}let m=e.width*c,g=e.height*c,h={scale:c,offsetX:t.x+r+(l-m)/2,offsetY:t.y+r+(o-g)/2,scaledWidth:m,scaledHeight:g,sourceWidth:e.width,sourceHeight:e.height,maskBounds:t,scalingStrategy:s.scalingStrategy,padding:r};return console.log("Task 8: Auto-fit transform calculated:",h),h},[]),e8=(0,r.useCallback)((e,a,t,s)=>{if(console.log("Task 8: Applying photo to mask with auto-fit"),!e||!a||!t||!s)return console.error("Task 8: Missing required parameters for photo application"),!1;let r=e.getContext("2d"),l=e$(t.maskPath);return l?(r.clearRect(0,0,e.width,e.height),r.save(),r.beginPath(),r.clip(l),r.drawImage(a,s.offsetX,s.offsetY,s.scaledWidth,s.scaledHeight),r.restore(),console.log("Task 8: Photo applied to mask successfully"),console.log("Task 8: Photo dimensions:",s.scaledWidth,"x",s.scaledHeight),console.log("Task 8: Position:",s.offsetX,"x",s.offsetY),!0):(console.error("Task 8: Failed to create mask path"),!1)},[e$]),e9=(0,r.useCallback)(async(e,a,t)=>{console.log("Task 8: Creating dynamic photo composition");try{let s=e6(e,a);if(!s)return console.error("Task 8: Failed to calculate auto-fit transform"),null;let r=document.createElement("canvas");if(r.width=a.exportInfo.dimensions.width,r.height=a.exportInfo.dimensions.height,!e8(r,e,a,s))return console.error("Task 8: Failed to apply photo to mask"),null;t&&(r.getContext("2d").drawImage(t,0,0),console.log("Task 8: Floral frame overlay applied"));let l=await e1(r);return l&&(console.log("Task 8: Dynamic photo composition completed"),console.log("Task 8: Auto-fit strategy:",s.scalingStrategy),console.log("Task 8: Scale factor:",s.scale.toFixed(2))),l}catch(e){return console.error("Task 8: Error creating dynamic photo composition:",e),null}},[e6,e8,e1]);(0,r.useCallback)(async(e,a)=>(console.log("Task 8: Processing uploaded photo for dynamic fitting"),new Promise((t,s)=>{let r=new Image;r.onload=async()=>{console.log("Task 8: Photo loaded successfully:",r.width,"x",r.height);let e=await e9(r,a,er);e?(console.log("Task 8: Dynamic photo processing completed"),t(e)):s(Error("Failed to create dynamic photo composition"))},r.onerror=()=>{s(Error("Failed to load photo"))},r.src=URL.createObjectURL(e)})),[e9,er]);let ae=()=>{if(!er)return;console.log("Processing Simplified Background Removal");let e=document.createElement("canvas"),a=e.getContext("2d");e.width=er.width,e.height=er.height,a.drawImage(er,0,0);let t=a.getImageData(0,0,e.width,e.height),s=t.data,r=0;for(let e=0;e<s.length;e+=4)(s[e]+s[e+1]+s[e+2])/3<80&&(s[e+3]=0,r++);a.putImageData(t,0,0),console.log("Background removal completed: ".concat(r," pixels made transparent")),e.toBlob(a=>{let t=URL.createObjectURL(a),s=new Image;s.onload=()=>{eH(s),eq(e),console.log("Processed image with transparent background ready")},s.src=t},"image/png")};(0,r.useEffect)(()=>{if(eB&&er){let e=setTimeout(()=>{ae()},300);return()=>clearTimeout(e)}},[eB,eI,eA,ez,eD,eU,eL,er]);let aa=(0,r.useCallback)(()=>{let e=ee.slice(0,et+1);e.push(JSON.parse(JSON.stringify(L))),ea(e),es(e.length-1)},[L,ee,et]),at=(0,r.useCallback)(()=>{et>0&&(es(et-1),G(ee[et-1]))},[ee,et]),as=(0,r.useCallback)(()=>{et<ee.length-1&&(es(et+1),G(ee[et+1]))},[ee,et]),ar=e=>{if("pen"!==D||"draw"!==ed)return;let a=f.current,t=a.getBoundingClientRect(),s=a.width/t.width,r=a.height/t.height,l=(e.clientX-t.left)*s/W-V.x,o=(e.clientY-t.top)*r/W-V.y;console.log("Start drawing at:",{x:l,y:o,scaleX:s,scaleY:r,zoom:W}),M(!0),Z([{x:l,y:o}])},al=e=>{if(!z||"pen"!==D||"draw"!==ed)return;let a=f.current,t=a.getBoundingClientRect(),s=a.width/t.width,r=a.height/t.height,l=(e.clientX-t.left)*s/W-V.x,o=(e.clientY-t.top)*r/W-V.y;Z(e=>[...e,{x:l,y:o}])},ao=()=>{z&&U.length>3&&(G([...L,{id:Date.now(),type:"freehand",points:U,feather:eu[0],shadowBlur:ex[0],shadowOffset:eb[0]}]),ec(U),aa()),M(!1),Z([])},an=async e=>{en(!0);let a=f.current;if(!a)return;let t=a.getContext("2d");a.width=e.width,a.height=e.height,t.drawImage(e,0,0);try{let a=[{x:50,y:50},{x:e.width-50,y:50},{x:e.width-50,y:e.height-50},{x:50,y:e.height-50}],t=[];for(let e=0;e<a.length;e++){let s=a[e],r=a[(e+1)%a.length];t.push(s);let l=(s.x+r.x)/2,o=(s.y+r.y)/2;0===e?t.push({x:l,y:o-20}):1===e?t.push({x:l+20,y:o}):2===e?t.push({x:l,y:o+20}):t.push({x:l-20,y:o})}ec(t)}catch(a){console.error("Border detection failed:",a),ec([{x:50,y:50},{x:e.width-50,y:50},{x:e.width-50,y:e.height-50},{x:50,y:e.height-50}])}finally{en(!1)}},ai=()=>{"draw"===ed?ao():(M(!1),Z([]),eP(null))};(0,r.useEffect)(()=>{let e=f.current,a=b.current;if(!e||!a||!er)return;let t=e.getContext("2d"),s=a.getContext("2d"),r=E.current?E.current.clientWidth:800,l=E.current?E.current.clientHeight:600,o=Math.min(r/er.width,l/er.height,1),n=er.width*o,i=er.height*o;if(e.width=n,e.height=i,a.width=n,a.height=i,e.style.width=n+"px",e.style.height=i+"px",a.style.width=n+"px",a.style.height=i+"px",t.clearRect(0,0,e.width,e.height),s.clearRect(0,0,a.width,a.height),t.save(),s.save(),t.scale(W,W),s.scale(W,W),t.translate(V.x,V.y),s.translate(V.x,V.y),t.globalAlpha=$[0],eW?(console.log("Using processed transparent image as source of truth"),t.drawImage(eW,0,0,n,i)):er&&(console.log("Using original image (no processed image available)"),t.drawImage(er,0,0,n,i)),t.globalAlpha=1,K){s.strokeStyle="rgba(0, 0, 0, 0.1)",s.lineWidth=1;for(let a=0;a<e.width;a+=50)s.beginPath(),s.moveTo(a,0),s.lineTo(a,e.height),s.stroke();for(let a=0;a<e.height;a+=50)s.beginPath(),s.moveTo(0,a),s.lineTo(e.width,a),s.stroke()}let c="draw"===ed&&U.length>0?U:ei;c&&Array.isArray(c)&&c.length>0&&(ex[0]>0&&(s.shadowBlur=ex[0],s.shadowOffsetX=eb[0],s.shadowOffsetY=eb[0],s.shadowColor="rgba(0, 0, 0, 0.3)"),s.strokeStyle="draw"===ed?"#10b981":"#ef4444",s.lineWidth="draw"===ed?3:4,s.setLineDash("draw"===ed?[]:[5,5]),s.lineCap="round",s.lineJoin="round",s.beginPath(),c.forEach((e,a)=>{0===a?s.moveTo(e.x,e.y):s.lineTo(e.x,e.y)}),"draw"!==ed&&s.closePath(),s.stroke(),s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0,"edit"===ed&&ei&&Array.isArray(ei)&&(s.fillStyle="#ef4444",ei.forEach(e=>{s.beginPath(),s.arc(e.x,e.y,6,0,2*Math.PI),s.fill()}))),t.restore(),s.restore()},[er,ei,U,W,V,K,$,ed,ex,eb]);let ac=async()=>{console.log("Save button clicked"),console.log("Current mode:",ed),console.log("Current path length:",U.length),console.log("Detected border length:",ei.length),console.log("onBorderSave exists:",!!c);let e="draw"===ed&&U.length>3?U:ei;if(console.log("Final border length:",e.length),e.length>0)try{eT(!0),console.log("Task 6: Starting standardized pipeline: Chroma Key → Mask → Frame → PNG Export");let s=await e4(e);if(!s){console.error("Task 6: Pipeline failed - no export result");return}console.log("Task 6: Standardized pipeline completed successfully"),console.log("Task 6: Export result:",{dimensions:s.dimensions,format:s.format,hasAlpha:s.hasAlpha,fileSize:(s.blob.size/1024/1024).toFixed(2)+"MB"});let r=await e7(e,s),l={polygon_points:e,svg_path:ad(e),feather_radius:eu[0],inner_usable_area:ag(e),chroma_key_metadata:eB?{enabled:!0,mode:eI,key_color:"auto"===eI?eY:eA,tolerance:ez[0],edge_feather:eD[0],edge_smoothness:eU[0],spill_suppression:eL[0]}:null,processed_image_info:{originalSize:(s.blob.size/1024/1024).toFixed(2)+"MB",dimensions:s.dimensions,format:s.format,hasAlpha:s.hasAlpha,timestamp:new Date().toISOString(),processedImageUrl:s.url,processedBlob:s.blob},export_metadata:{pipeline:"chroma_key_mask_frame_png",quality:s.quality,transparency:"preserved",source:"processed_transparent_image"},comprehensive_metadata:r};if(p){console.log("Task 6: Saving to backend API");let e=(await t.e(6657).then(t.bind(t,6657))).default,{toast:a}=await t.e(7776).then(t.bind(t,27776));await e.put("/api/admin/theme-assets/borders/".concat(p,"/mask"),l),a.success("Border mask and processed image saved successfully!"),console.log("Task 6: Backend save completed")}c&&(console.log("Task 6: Calling onBorderSave with processed transparent image as primary source"),c({points:e,feather:eu[0],shadowBlur:ex[0],shadowOffset:eb[0],assetType:g,mode:ed,shapes:L,maskData:l,processedImage:s,processedImageUrl:s.url,processedBlob:s.blob,originalImage:er,originalImageUrl:a,source:"processed_transparent_image",hasTransparency:s.hasAlpha,pipeline:"chroma_key_mask_frame_png"}),console.log("Task 6: onBorderSave called with processed transparent image as source of truth")),eT(!1)}catch(e){console.error("Save failed:",e),setError("Failed to save border. Please try again."),eT(!1)}else console.log("Save conditions not met:",{hasBorder:e.length>0,hasCallback:!!c,borderLength:e.length})},ad=e=>{if(!e||0===e.length)return"";let a="M ".concat(e[0].x," ").concat(e[0].y);for(let t=1;t<e.length-1;t++){let s=e[t],r=e[t+1],l=(s.x+r.x)/2,o=(s.y+r.y)/2;a+=" Q ".concat(s.x," ").concat(s.y,", ").concat(l," ").concat(o)}if(e.length>2){let t=e[e.length-1],s=e[0];a+=" L ".concat(t.x," ").concat(t.y," L ").concat(s.x," ").concat(s.y)}return a+" Z"},am=e=>{let a=0,t=0,s=0;for(let r=0;r<e.length;r++){let l=e[r],o=e[(r+1)%e.length],n=l.x*o.y-o.x*l.y;s+=n,a+=(l.x+o.x)*n,t+=(l.y+o.y)*n}return Math.abs(s/=2)>1e-4?(a/=6*s,t/=6*s):(a=e.reduce((e,a)=>e+a.x,0)/e.length,t=e.reduce((e,a)=>e+a.y,0)/e.length),{x:a,y:t}},ag=e=>{if(!e||0===e.length)return{x:0,y:0,width:0,height:0};let a=e.map(e=>e.x),t=e.map(e=>e.y),s=Math.min(...a),r=Math.min(...t),l=eu[0];return{x:s+l,y:r+l,width:Math.max(...a)-s-2*l,height:Math.max(...t)-r-2*l}};return(0,s.jsxs)(l.Zb,{className:h,children:[(0,s.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(y.Z,{className:"w-5 h-5"}),"Border Editor - ",g.charAt(0).toUpperCase()+g.slice(1)]}),(0,s.jsx)(o.z,{onClick:d,variant:"ghost",size:"sm",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)(l.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(o.z,{onClick:()=>em("detect"),variant:"detect"===ed?"default":"outline",size:"sm",children:[(0,s.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Auto Detect"]}),(0,s.jsxs)(o.z,{onClick:()=>em("draw"),variant:"draw"===ed?"default":"outline",size:"sm",children:[(0,s.jsx)(k.Z,{className:"w-4 h-4 mr-2"}),"Draw"]}),(0,s.jsxs)(o.z,{onClick:()=>em("edit"),variant:"edit"===ed?"default":"outline",size:"sm",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Edit"]})]}),(0,s.jsxs)(l.Zb,{className:"border-dashed",children:[(0,s.jsx)(l.Ol,{className:"pb-3",children:(0,s.jsxs)(l.ll,{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)(w.Z,{className:"w-4 h-4"}),"Chroma Key Background Removal"]})}),(0,s.jsxs)(l.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:eB,onChange:e=>eR(e.target.checked),className:"mr-2 w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Enable Background Removal"})]}),eB&&(0,s.jsx)(n.C,{variant:"default",className:"text-xs",children:"Active"})]}),eB&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(o.z,{onClick:()=>eE("auto"),variant:"auto"===eI?"default":"outline",size:"sm",className:"text-xs",children:[(0,s.jsx)(j.Z,{className:"w-3 h-3 mr-1"}),"Auto Detect"]}),(0,s.jsxs)(o.z,{onClick:()=>eE("custom"),variant:"custom"===eI?"default":"outline",size:"sm",className:"text-xs",children:[(0,s.jsx)(w.Z,{className:"w-3 h-3 mr-1"}),"Custom Color"]})]}),"custom"===eI&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Key Color:"}),(0,s.jsx)("input",{type:"color",value:eA,onChange:e=>eF(e.target.value),className:"w-12 h-8 border rounded cursor-pointer"}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:eA})]}),"auto"===eI&&eY&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Detected:"}),(0,s.jsx)("div",{className:"w-12 h-8 border rounded",style:{backgroundColor:eY}}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:eY})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium mb-2 block",children:["Tolerance: ",ez[0],"%"]}),(0,s.jsx)(v.i,{value:ez,onValueChange:eM,max:100,min:0,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium mb-2 block",children:["Edge Feather: ",eD[0],"px"]}),(0,s.jsx)(v.i,{value:eD,onValueChange:eO,max:10,min:0,step:.5,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium mb-2 block",children:["Edge Smoothness: ",eU[0],"%"]}),(0,s.jsx)(v.i,{value:eU,onValueChange:eZ,max:100,min:0,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium mb-2 block",children:["Spill Suppression: ",eL[0],"%"]}),(0,s.jsx)(v.i,{value:eL,onValueChange:eG,max:100,min:0,step:1,className:"w-full"})]})]}),(0,s.jsxs)(o.z,{onClick:()=>ae(),disabled:!er,size:"sm",className:"w-full",children:[(0,s.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Process Background Removal"]})]})]})]}),"draw"===ed&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.z,{onClick:()=>O("pen"),variant:"pen"===D?"default":"outline",size:"sm",children:(0,s.jsx)(k.Z,{className:"w-4 h-4"})}),(0,s.jsx)(o.z,{onClick:at,disabled:et<=0,variant:"outline",size:"sm",children:(0,s.jsx)(T.Z,{className:"w-4 h-4"})}),(0,s.jsx)(o.z,{onClick:as,disabled:et>=ee.length-1,variant:"outline",size:"sm",children:(0,s.jsx)(C.Z,{className:"w-4 h-4"})}),(0,s.jsx)(o.z,{onClick:()=>J(!K),variant:K?"default":"outline",size:"sm",children:(0,s.jsx)(S.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:["detect"===ed&&(0,s.jsxs)(o.z,{onClick:()=>{er&&(an(er),G([]),Z([]))},disabled:eo||!er,variant:"outline",size:"sm",children:[(0,s.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),eo?"Detecting...":"Redetect"]}),"draw"===ed&&(0,s.jsxs)(o.z,{onClick:()=>{Z([]),G([]),ec([]),aa()},variant:"outline",size:"sm",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Clear"]}),x&&(0,s.jsxs)(o.z,{onClick:()=>ej(!ew),variant:ew?"default":"outline",size:"sm",children:[(0,s.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),ew?"Hide":"Show"," Preview"]}),(0,s.jsx)(o.z,{onClick:ac,disabled:eN||!p&&!c||"detect"===ed&&0===ei.length||"draw"===ed&&U.length<3,size:"sm",children:eN?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Save Border"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.z,{onClick:()=>H(Math.max(.5,W-.25)),variant:"outline",size:"sm",children:(0,s.jsx)(B.Z,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm",children:[Math.round(100*W),"%"]}),(0,s.jsx)(o.z,{onClick:()=>H(Math.min(3,W+.25)),variant:"outline",size:"sm",children:(0,s.jsx)(R.Z,{className:"w-4 h-4"})})]}),(0,s.jsx)(o.z,{onClick:()=>{H(1),q({x:0,y:0})},variant:"outline",size:"sm",children:(0,s.jsx)(I.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Detection Sensitivity"}),(0,s.jsx)(v.i,{value:eg,onValueChange:eh,max:100,min:1,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Feather Radius"}),(0,s.jsx)(v.i,{value:eu,onValueChange:ep,max:20,min:0,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Shadow Blur"}),(0,s.jsx)(v.i,{value:ex,onValueChange:ef,max:50,min:0,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Shadow Offset"}),(0,s.jsx)(v.i,{value:eb,onValueChange:ev,max:20,min:0,step:1,className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Template Opacity"}),(0,s.jsx)(v.i,{value:$,onValueChange:Q,max:1,min:.1,step:.1,className:"w-full"})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:["detect"===ed&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Redetect"})," to find borders automatically"]}),(0,s.jsxs)("p",{children:["• Switch to ",(0,s.jsx)("strong",{children:"Draw"})," mode to create custom borders"]})]}),"draw"===ed&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Click & Drag"})," to draw custom border shape"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Undo/Redo"})," to correct mistakes"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Grid"})," for precision drawing"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Natural freehand"})," - follows cursor path exactly"]})]}),"edit"===ed&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("strong",{children:"Move tool"})," to pan the canvas"]}),(0,s.jsxs)("p",{children:["• Switch to ",(0,s.jsx)("strong",{children:"Draw"})," mode to create new shapes"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.C,{variant:"detect"===ed?"default":"secondary",children:"detect"===ed?"Auto-Detect":"draw"===ed?"Drawing":"Editing"}),"draw"===ed&&U.length>0&&(0,s.jsxs)(n.C,{variant:"outline",children:[U.length," points"]}),K&&(0,s.jsx)(n.C,{variant:"outline",children:"Grid On"})]}),ew&&ey&&ei.length>0&&(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsxs)(l.ll,{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)(_.Z,{className:"w-4 h-4"}),"Real-time Mask Preview"]})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("div",{className:"relative border rounded-lg overflow-hidden bg-gray-100",style:{maxWidth:"400px",maxHeight:"400px",margin:"0 auto"},children:[(0,s.jsx)("div",{style:{position:"relative",width:"100%",aspectRatio:"1",clipPath:ei.length>0?"polygon(".concat(ei.map(e=>"".concat(e.x,"px ").concat(e.y,"px")).join(", "),")"):"none"},children:(0,s.jsx)("img",{src:x,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(".concat(eu[0],"px)")}})}),(0,s.jsxs)("div",{className:"absolute bottom-2 left-2 right-2 bg-black/60 text-white text-xs p-2 rounded",children:[(0,s.jsxs)("div",{children:["Feather: ",eu[0],"px"]}),(0,s.jsxs)("div",{children:["Points: ",ei.length]})]})]})})]}),eB&&eW&&(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsxs)(l.ll,{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)(w.Z,{className:"w-4 h-4"}),"Chroma Key Preview - Background Removed"]})}),(0,s.jsxs)(l.aY,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-red-700 mb-2",children:"Original"}),(0,s.jsx)("div",{className:"relative border rounded-lg overflow-hidden bg-gray-100",style:{maxHeight:"200px"},children:(0,s.jsx)("img",{src:a,alt:"Original",className:"w-full h-full object-contain",style:{maxHeight:"200px"}})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-green-700 mb-2",children:"Processed (Transparent)"}),(0,s.jsx)("div",{className:"relative border rounded-lg overflow-hidden",style:{maxHeight:"200px",backgroundImage:"repeating-conic-gradient(#e5e7eb 0% 25%, transparent 0% 50%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"},children:(0,s.jsx)("img",{src:eW.src,alt:"Processed",className:"w-full h-full object-contain",style:{maxHeight:"200px"}})})]})]}),(0,s.jsx)("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Mode:"})," ",eI]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Tolerance:"})," ",ez[0],"%"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Feather:"})," ",eD[0],"px"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Key Color:"}),(0,s.jsx)("span",{className:"inline-block w-3 h-3 ml-1 border border-gray-300 rounded",style:{backgroundColor:"auto"===eI?eY:eA}})]})]})})]})]}),(0,s.jsxs)("div",{ref:E,className:"border rounded-lg overflow-auto bg-gray-50 max-h-96 relative",style:{minHeight:"400px",minWidth:"600px"},children:[!er&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-lg mb-2",children:"No image loaded"}),(0,s.jsx)("div",{className:"text-sm",children:"Please upload an image to edit borders"})]})}),(0,s.jsx)("canvas",{ref:f,className:"relative",style:{maxWidth:"100%",height:"auto",display:er?"block":"none",cursor:"draw"===ed&&"pen"===D?"crosshair":"edit"===ed?"move":"default"},onMouseDown:e=>{if("draw"===ed)ar(e);else if("edit"===ed){let a=f.current,t=a.getBoundingClientRect(),s=a.width/t.width,r=a.height/t.height,l=(e.clientX-t.left)*s/W-V.x,o=(e.clientY-t.top)*r/W-V.y;if(ei&&Array.isArray(ei)){let e=ei.findIndex(e=>10>Math.sqrt(Math.pow(e.x-l,2)+Math.pow(e.y-o,2)));if(-1!==e){eP(e),M(!0);return}}"move"===D&&(M(!0),Z([{x:e.clientX-V.x*W,y:e.clientY-V.y*W}]))}},onMouseMove:e=>{if("draw"===ed)al(e);else if("edit"===ed&&z){let a=f.current,t=a.getBoundingClientRect(),s=a.width/t.width,r=a.height/t.height,l=(e.clientX-t.left)*s/W-V.x,o=(e.clientY-t.top)*r/W-V.y;if(null!==e_){let e=[...ei];e[e_]={x:l,y:o},ec(e)}else"move"===D&&q({x:(e.clientX-U[0].x)/W,y:(e.clientY-U[0].y)/W})}},onMouseUp:ai,onMouseLeave:ai}),(0,s.jsx)("canvas",{ref:b,className:"absolute top-0 left-0 pointer-events-none",style:{maxWidth:"100%",height:"auto",display:er?"block":"none"}})]})]})]})}let A=(0,t(78614).bR)();function F(){let e=(0,f.useRouter)(),[a,t]=(0,r.useState)(!0),[v,y]=(0,r.useState)(!1),[k,w]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[T,C]=(0,r.useState)([]),[S,_]=(0,r.useState)("all"),[P,B]=(0,r.useState)(null),[R,I]=(0,r.useState)(null),[F,z]=(0,r.useState)(""),[M,D]=(0,r.useState)(""),[O,U]=(0,r.useState)(!0),[Z,L]=(0,r.useState)("border"),[G,Y]=(0,r.useState)(!1),[X,W]=(0,r.useState)(!1),[H,V]=(0,r.useState)(null),[q,K]=(0,r.useState)(0),[J,$]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(!1),[ea,et]=(0,r.useState)(!1),[es,er]=(0,r.useState)(null),[el,eo]=(0,r.useState)(null),[en,ei]=(0,r.useState)(null);(0,r.useEffect)(()=>{ec(),ed()},[]);let ec=async()=>{let a=localStorage.getItem("token");if(!a){e.push("/login");return}try{let t=await b.Z.get("".concat(A,"/api/auth/me"),{headers:{Authorization:"Bearer ".concat(a)}});"admin"!==t.data.role&&(w("Access denied. Admin privileges required."),setTimeout(()=>e.push("/admin"),2e3))}catch(a){console.error("Auth check failed:",a),e.push("/login")}},ed=async()=>{let e=localStorage.getItem("token");if(e)try{t(!0);let a=await b.Z.get("".concat(A,"/api/admin/borders"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("[ADMIN_BORDERS] API Response:",{totalBorders:a.data.length,borders:a.data.map(e=>({name:e.name,category:e.category}))});let s={all:a.data.length,border:a.data.filter(e=>"border"===(e.category||"border")).length,background:a.data.filter(e=>"background"===(e.category||"border")).length};console.log("[ADMIN_BORDERS] Category counts:",s),C(a.data)}catch(e){console.error("Error loading borders:",e),w("Failed to load borders")}finally{t(!1)}},em=async e=>{let a=e.target.files[0];if(!a)return;if(V(null),K(0),$(null),w(null),N(null),a.size>10485760){w("File size exceeds 10MB limit");return}if(!a.type.startsWith("image/")){w("Only image files are allowed");return}B(a);let t=new FileReader;t.onload=async e=>{let a=e.target.result;I(a),er(a),ee(!0);try{let e=await ep(a);$(e),"needs_removal"===e.recommendation?(Y(!0),N("Black background detected! Background removal has been enabled automatically."),setTimeout(()=>{ef()},100)):"excellent"===e.recommendation&&N("Perfect! This image already has good transparency.")}catch(e){console.error("Transparency check failed:",e)}finally{ee(!1)}},t.readAsDataURL(a)},eg=async e=>{console.log("Border data received from editor:",e),eo(e.maskData),et(!1),N('Mask defined! Now click "Upload Border" to save.')},eh=async e=>new Promise((a,t)=>{console.log("[Background Removal] Starting ultra-fast processing");let s=performance.now(),r=new Image;r.onload=()=>{let e=r.width,l=r.height;if(e>1e3||l>1e3){let a=Math.min(1e3/e,1e3/l);e*=a,l*=a}let o=document.createElement("canvas"),n=o.getContext("2d");o.width=e,o.height=l,n.drawImage(r,0,0,e,l);let i=n.getImageData(0,0,e,l),c=i.data,d=0;for(let e=0;e<c.length;e+=4){let a=c[e],t=c[e+1],s=c[e+2];a<20&&t<20&&s<20&&(c[e+3]=0,d++)}n.putImageData(i,0,0);let m=performance.now()-s;console.log("[Background Removal] Ultra-fast processing completed in ".concat(m.toFixed(2),"ms - ").concat(d," pixels removed")),o.toBlob(e=>{e?a(e):t(Error("Failed to create PNG blob"))},"image/png",1)},r.onerror=t,r.src=URL.createObjectURL(e)}),eu=(e,a,t,s,r)=>{let l=(t*s+a)*4,o=(e[l]+e[l+1]+e[l+2])/3;for(let l=-2;l<=2;l++)for(let n=-2;n<=2;n++){if(0===l&&0===n)continue;let i=a+l,c=t+n;if(i>=0&&i<s&&c>=0&&c<r){let a=(c*s+i)*4;if(Math.abs(o-(e[a]+e[a+1]+e[a+2])/3)>60)return!0}}return!1},ep=async e=>new Promise(a=>{let t=new Image;t.crossOrigin="anonymous",t.onload=()=>{let e=document.createElement("canvas"),s=e.getContext("2d");e.width=t.width,e.height=t.height,s.drawImage(t,0,0);let r=s.getImageData(0,0,e.width,e.height).data,l=0,o=0,n=0,i=0;for(let a=0;a<r.length;a+=4){let t=r[a],s=r[a+1],c=r[a+2],d=r[a+3];if(n++,d<255&&l++,t<=30&&s<=30&&c<=30){o++;let t=a/4;eu(r,t%e.width,Math.floor(t/e.width),e.width,e.height)&&i++}}let c=l/n*100,d=(o-i)/n*100,m={hasTransparency:c>1,transparencyPercentage:c.toFixed(2),blackBackgroundPercentage:d.toFixed(2),totalPixels:n,transparentPixels:l,blackPixels:o,edgePixels:i,recommendation:ex(c,d)};console.log("[Transparency Check] Result:",m),a(m)},t.onerror=()=>{a({hasTransparency:!1,error:"Failed to load image for transparency check",recommendation:"error"})},t.src=e}),ex=(e,a)=>e>5?"excellent":e>1?"good":a>10?"needs_removal":a>1?"check_manually":"unknown",ef=async()=>{if(!P){console.warn("[Background Removal] No file selected");return}W(!0),K(50);try{console.log("[Background Removal] Starting instant processing for:",P.name);let e=await eh(P);K(90);let a=new FileReader;a.onload=a=>{V(a.target.result),K(100),W(!1);let t=(e.size/1024/1024).toFixed(2);console.log("[Background Removal] Completed instantly. File size: ".concat(t,"MB")),N("Background removed instantly! Processed file size: ".concat(t,"MB"))},a.readAsDataURL(e)}catch(e){console.error("Background removal failed:",e),w("Failed to remove background. Please try again."),W(!1),K(0)}},eb=()=>(console.log("[TRANSPARENT BORDER FIX] Auto-creating default rectangular mask for background-removed border"),{svg_path:"",polygon_points:[],feather_radius:8,inner_usable_area:{x:0,y:0,width:0,height:0},processedImage:null}),ev=async()=>{var e,a,t,s,r,l;if(!P){w("Please select an image file");return}if(!F.trim()){w("Please enter a border name");return}console.log("[BORDER_UPLOAD] Category selected:",Z),console.log("[BORDER_UPLOAD] Border name:",F),console.log("[BORDER_UPLOAD] Full upload details:",{name:F,category:Z,tags:M,supportsMirror:O,hasTransparency:G||null!==H});let o=el;if(!el&&(G||H)&&(console.log("[TRANSPARENT BORDER FIX] No mask defined, but background removal was done"),console.log("[TRANSPARENT BORDER FIX] Creating default mask to allow transparent border upload"),eo(o=eb())),!o){w("Please define mask using Border Editor or enable background removal");return}let n=localStorage.getItem("token"),i=new FormData,c=P,d=P.name.split(".").pop().toLowerCase(),m=d;if(o&&o.processedImage&&o.processedImage.blob)try{console.log("[Upload] Using processed transparent image from BorderEditor");let e=el.processedImage.blob;d="png",c=new File([e],P.name.replace(/\.[^/.]+$/,".png"),{type:"image/png"}),console.log("[Upload] PNG-32 format enforced with BorderEditor processed image:",{originalFormat:m,newFormat:"png",fileSize:(c.size/1024/1024).toFixed(2)+"MB",hasTransparency:!0,source:"BorderEditor processed image"})}catch(e){console.error("[Upload] Failed to use BorderEditor processed image:",e),w("Failed to use processed transparent image. Please try again.");return}else if(H)try{console.log("[Upload] Using processed image from old system - enforcing PNG-32 format");let e=await fetch(H),a=await e.blob();d="png",c=new File([a],P.name.replace(/\.[^/.]+$/,".png"),{type:"image/png"}),console.log("[Upload] PNG-32 format enforced (old system):",{originalFormat:m,newFormat:"png",fileSize:(c.size/1024/1024).toFixed(2)+"MB",hasTransparency:!0})}catch(e){console.error("[Upload] Failed to process image for PNG-32 conversion:",e),w("Failed to convert image to PNG-32 format. Please try again.");return}else if(G){console.log("[Upload] Background removal requested but no processed image - converting to PNG-32");let e=document.createElement("canvas"),a=e.getContext("2d"),t=new Image;await new Promise(s=>{t.onload=()=>{e.width=t.width,e.height=t.height,a.drawImage(t,0,0),e.toBlob(e=>{c=new File([e],P.name.replace(/\.[^/.]+$/,".png"),{type:"image/png"}),d="png",console.log("[Upload] PNG-32 conversion complete with full alpha channel"),s()},"image/png",1)},t.src=URL.createObjectURL(P)})}i.append("file",c),i.append("name",F),i.append("tags",M),i.append("supports_mirror",O),i.append("category",Z),console.log("[UPLOAD] FormData category being sent:",Z),console.log("[UPLOAD] FormData entries:",{name:F,category:Z,tags:M,supports_mirror:O});let g=G||null!==H||o&&o.processedImage;i.append("has_transparency",g.toString()),i.append("remove_background",G.toString()),console.log("[Upload] Transparency metadata:",{hasTransparency:g,removeBackground:G,processedPreview:!!H,maskDataProcessed:!!(o&&o.processedImage)}),o.svg_path&&i.append("mask_svg_path",o.svg_path),o.polygon_points&&o.polygon_points.length>0&&i.append("mask_polygon_points",JSON.stringify(o.polygon_points)),i.append("feather_radius",o.feather_radius||8),i.append("mask_x",(null===(e=o.inner_usable_area)||void 0===e?void 0:e.x)||0),i.append("mask_y",(null===(a=o.inner_usable_area)||void 0===a?void 0:a.y)||0),i.append("mask_width",(null===(t=o.inner_usable_area)||void 0===t?void 0:t.width)||0),i.append("mask_height",(null===(s=o.inner_usable_area)||void 0===s?void 0:s.height)||0);try{y(!0),w(null);let e=await b.Z.post("".concat(A,"/api/admin/borders/upload"),i,{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"multipart/form-data"}});N("Border uploaded successfully!"),console.log("[UPLOAD_SUCCESS] Border uploaded with details:",{id:e.data.id,name:e.data.name,category:e.data.category,expected_category:Z}),e.data.category!==Z&&console.error("[UPLOAD_WARNING] Category mismatch!",{selected:Z,saved:e.data.category}),C([e.data,...T]),B(null),I(null),z(""),D(""),U(!0),L("border"),eo(null),er(null),document.getElementById("border-file-input").value="",ed(),setTimeout(()=>N(null),3e3)}catch(e){console.error("Border upload failed:",e),w((null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.detail)||"Failed to upload border")}finally{y(!1)}},ey=async e=>{ei(e),er(e.cdn_url),et(!0)},ek=async e=>{var a,t,s,r,l,o;if(!en)return;let n=localStorage.getItem("token"),i=new FormData,c=e.maskData;c.svg_path&&i.append("mask_svg_path",c.svg_path),c.polygon_points&&c.polygon_points.length>0&&i.append("mask_polygon_points",JSON.stringify(c.polygon_points)),i.append("feather_radius",c.feather_radius||8),i.append("mask_x",(null===(a=c.inner_usable_area)||void 0===a?void 0:a.x)||0),i.append("mask_y",(null===(t=c.inner_usable_area)||void 0===t?void 0:t.y)||0),i.append("mask_width",(null===(s=c.inner_usable_area)||void 0===s?void 0:s.width)||0),i.append("mask_height",(null===(r=c.inner_usable_area)||void 0===r?void 0:r.height)||0);try{y(!0);let e=await b.Z.put("".concat(A,"/api/admin/borders/").concat(en.id,"/mask"),i,{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"multipart/form-data"}});N("Border mask updated successfully!"),C(T.map(a=>a.id===en.id?e.data:a)),et(!1),ei(null),setTimeout(()=>N(null),3e3)}catch(e){console.error("Mask update failed:",e),w((null===(o=e.response)||void 0===o?void 0:null===(l=o.data)||void 0===l?void 0:l.detail)||"Failed to update mask")}finally{y(!1)}},ew=async e=>{if(!confirm("Are you sure you want to delete this border?"))return;let a=localStorage.getItem("token");try{await b.Z.delete("".concat(A,"/api/admin/borders/").concat(e),{headers:{Authorization:"Bearer ".concat(a)}}),C(T.filter(a=>a.id!==e)),N("Border deleted successfully"),setTimeout(()=>N(null),3e3)}catch(e){console.error("Delete failed:",e),w("Failed to delete border")}};return a?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(i.Z,{className:"w-12 h-12 text-rose-500 animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading borders..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)(o.z,{variant:"ghost",onClick:()=>e.push("/admin"),className:"mb-2",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Back to Admin Dashboard"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Border Management"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Upload and manage photo borders with custom masks"})]})}),k&&(0,s.jsxs)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center",children:[(0,s.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),k,(0,s.jsx)("button",{onClick:()=>w(null),className:"ml-auto",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})})]}),j&&(0,s.jsxs)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center",children:[(0,s.jsx)(g.Z,{className:"w-5 h-5 mr-2"}),j,(0,s.jsx)("button",{onClick:()=>N(null),className:"ml-auto",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)(l.Zb,{className:"p-6 mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[(0,s.jsx)(h.Z,{className:"w-5 h-5 mr-2 text-rose-500"}),"Upload New Border with Mask"]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Border Image (Max 10MB)"}),(0,s.jsx)("input",{id:"border-file-input",type:"file",accept:"image/*",onChange:em,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:G,onChange:e=>{let a=e.target.checked;Y(a),a&&P&&setTimeout(()=>{ef()},100)},className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm",children:"Remove Background"})]}),P&&!G&&(0,s.jsx)("button",{onClick:()=>{Y(!0),setTimeout(()=>{em({target:{files:[P]}})},100)},className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 transition-colors",children:"Remove Background Now"})]}),X&&(0,s.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"Processing background removal..."}),(0,s.jsxs)("span",{className:"text-sm text-blue-700",children:[q,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(q,"%")}})})]}),R&&(0,s.jsx)("div",{className:"space-y-4",children:H?(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Original"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("img",{src:R,alt:"Original",className:"w-full h-48 object-contain rounded-lg border-2 border-gray-200 bg-white"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"Processed (Transparent)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-full h-48 rounded-lg border-2 border-green-200 overflow-hidden",style:{backgroundImage:"repeating-conic-gradient(#e5e7eb 0% 25%, transparent 0% 50%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"},children:(0,s.jsx)("img",{src:H,alt:"Processed",className:"w-full h-full object-contain"})}),(0,s.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded",children:"Background Removed"})]})]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-red-700 mb-2",children:"Original"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:R,alt:"Original",className:"w-full h-48 object-contain rounded-lg border-2 border-red-200 bg-white"}),(0,s.jsx)("div",{className:"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded",children:"Original Image"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"Processed (Transparent)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-full h-48 rounded-lg border-2 border-green-200 overflow-hidden",style:{backgroundImage:"repeating-conic-gradient(#e5e7eb 0% 25%, transparent 0% 50%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"},children:el&&el.processedImage&&el.processedImage.url?(0,s.jsx)("img",{src:el.processedImage.url,alt:"Processed Transparent",className:"w-full h-full object-contain"}):H?(0,s.jsx)("img",{src:H,alt:"Processed",className:"w-full h-full object-contain"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:X?(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-xs",children:"Processing..."})]}):(0,s.jsx)("p",{className:"text-xs",children:'Click "Remove Background" to process'})})}),(0,s.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded",children:H?"Background Removed":"Waiting"})]})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Border Name *"}),(0,s.jsx)("input",{type:"text",value:F,onChange:e=>z(e.target.value),placeholder:"Floral Wedding Border",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Border Category *"}),(0,s.jsxs)("select",{value:Z,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500",children:[(0,s.jsx)("option",{value:"border",children:"Border"}),(0,s.jsx)("option",{value:"background",children:"Background"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"border"===Z?"✓ For: Bride/Groom photos (mirror effect), Couple, Studio, Precious Moments, Live stream background":"✓ For: Theme background, Live streaming page background"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),(0,s.jsx)("input",{type:"text",value:M,onChange:e=>D(e.target.value),placeholder:"floral, elegant, traditional",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"supports-mirror",checked:O,onChange:e=>U(e.target.checked),className:"w-4 h-4 text-rose-600 border-gray-300 rounded focus:ring-rose-500"}),(0,s.jsx)("label",{htmlFor:"supports-mirror",className:"ml-2 text-sm font-medium text-gray-700",children:"Supports Mirror (for Bride/Groom separate mode)"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,s.jsxs)(o.z,{onClick:()=>{if(!P){w("Please select an image first");return}et(!0)},disabled:!P,variant:"outline",className:"flex items-center",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),el?"Edit Mask":"Define Mask"]}),P&&(0,s.jsx)(o.z,{onClick:()=>{G?(Y(!1),V(null)):(Y(!0),setTimeout(()=>{ef()},100))},variant:G?"default":"outline",className:"flex items-center ".concat(G?"bg-green-600 hover:bg-green-700":""),children:G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"Background Removed"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Remove Background"]})}),el&&(0,s.jsxs)(n.C,{variant:"default",className:"flex items-center gap-1",children:[(0,s.jsx)(g.Z,{className:"w-3 h-3"}),"Mask Defined"]})]}),(0,s.jsx)(o.z,{onClick:ev,disabled:v||!P||!F,className:"w-full",children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Upload Border"]})})]})]}),(0,s.jsxs)(l.Zb,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 flex items-center justify-between",children:(0,s.jsxs)("span",{children:["Uploaded Borders (",T.length,")"]})}),(0,s.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"All Borders"},{key:"border",label:"Border"},{key:"background",label:"Background"}].map(e=>{let a="all"===e.key?T.length:T.filter(a=>(a.category||"border")===e.key).length;return(0,s.jsxs)("button",{onClick:()=>_(e.key),className:"px-4 py-2 font-medium text-sm rounded-t-lg transition-colors ".concat(S===e.key?"bg-rose-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),"data-testid":"filter-".concat(e.key),children:[e.label," (",a,")"]},e.key)})})}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.filter(e=>{let a=e.category||"border";return"all"===S||a===S}).map(e=>{var a,t,r,l,i;return(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:e.processed_image_url||e.cdn_url,alt:e.name,className:"w-full h-48 object-cover",style:{backgroundImage:e.processed_image_url?"repeating-conic-gradient(#f0f0f0 0% 25%, #ffffff 0% 50%) 50% / 20px 20px":"none"}}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,s.jsx)(o.z,{size:"sm",variant:"secondary",onClick:()=>ey(e),className:"bg-white/90 hover:bg-white",children:(0,s.jsx)(u.Z,{className:"w-3 h-3"})}),(0,s.jsx)(o.z,{size:"sm",variant:"destructive",onClick:()=>ew(e.id),className:"bg-red-500/90 hover:bg-red-600",children:(0,s.jsx)(x.Z,{className:"w-3 h-3"})})]})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg truncate",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[(0,s.jsx)("span",{children:e.orientation}),(0,s.jsxs)("span",{children:[e.width,"x",e.height]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,s.jsx)(n.C,{variant:"outline",className:"text-xs",children:(null===(a=e.mask)||void 0===a?void 0:a.suggested_aspect_ratio)||"1:1"}),e.supports_mirror&&(0,s.jsx)(n.C,{variant:"secondary",className:"text-xs",children:"Mirror Support"})]}),e.category&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(n.C,{variant:"default",className:"text-xs ".concat("border"===e.category?"bg-purple-500":"bg-green-500"),children:"border"===e.category?"Border":"Background"})}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map((e,a)=>(0,s.jsx)(n.C,{variant:"secondary",className:"text-xs",children:e},a))}),(0,s.jsxs)("div",{className:"mt-3 text-xs text-gray-500",children:[(0,s.jsxs)("div",{children:["Feather: ",(null===(t=e.mask)||void 0===t?void 0:t.feather_radius)||8,"px"]}),(null===(r=e.mask)||void 0===r?void 0:r.svg_path)&&(0,s.jsx)("div",{className:"text-green-600",children:"✓ SVG Mask"}),(null===(i=e.mask)||void 0===i?void 0:null===(l=i.polygon_points)||void 0===l?void 0:l.length)>0&&(0,s.jsxs)("div",{className:"text-blue-600",children:["✓ Polygon Mask (",e.mask.polygon_points.length," points)"]}),e.mask_slots&&e.mask_slots.length>0&&(0,s.jsxs)("div",{className:"text-purple-600 font-semibold",children:["✓ ",e.mask_slots.length," Photo Slots"]})]})]})]},e.id)})}),0===T.filter(e=>{let a=e.category||"border";return"all"===S||a===S}).length&&(0,s.jsx)("p",{className:"text-center text-gray-500 py-8 col-span-3",children:"all"===S?"No borders uploaded yet":'No borders in "'.concat(S,'" category')})]}),ea&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-auto",children:(0,s.jsx)(E,{imageUrl:es,onBorderSave:en?ek:eg,onClose:()=>{et(!1),en||er(null),ei(null)},assetType:"border",className:"m-4"})})})]})})}},79004:function(e,a,t){"use strict";t.d(a,{C:function(){return n}});var s=t(57437);t(2265);var r=t(13027),l=t(77700);let o=(0,r.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)(o({variant:t}),a),...r})}},56360:function(e,a,t){"use strict";t.d(a,{z:function(){return c}});var s=t(57437),r=t(2265),l=t(71538),o=t(13027),n=t(77700);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,a)=>{let{className:t,variant:r,size:o,asChild:c=!1,...d}=e,m=c?l.g7:"button";return(0,s.jsx)(m,{className:(0,n.cn)(i({variant:r,size:o,className:t})),ref:a,...d})});c.displayName="Button"},10273:function(e,a,t){"use strict";t.d(a,{Ol:function(){return n},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},eW:function(){return m},ll:function(){return i}});var s=t(57437),r=t(2265),l=t(77700);let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...r})});o.displayName="Card";let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});n.displayName="CardHeader";let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("font-semibold leading-none tracking-tight",t),...r})});i.displayName="CardTitle";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("p-6 pt-0",t),...r})});d.displayName="CardContent";let m=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})});m.displayName="CardFooter"},85398:function(e,a,t){"use strict";t.d(a,{i:function(){return n}});var s=t(57437),r=t(2265),l=t(67553),o=t(77700);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsxs)(l.fC,{ref:a,className:(0,o.cn)("relative flex w-full touch-none select-none items-center",t),...r,children:[(0,s.jsx)(l.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,s.jsx)(l.e6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(l.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});n.displayName=l.fC.displayName},78614:function(e,a,t){"use strict";t.d(a,{bR:function(){return o},ww:function(){return n}});var s=t(20357);let r=()=>{{let e=window.location.hostname;return e.includes("vercel.app")||e.includes("wedlive.vercel.app")}},l={API:{BASE_URL:(()=>{let e=s.env.NEXT_PUBLIC_BACKEND_URL||s.env.REACT_APP_BACKEND_URL||s.env.NEXT_PUBLIC_API_URL;if(e)return e;{let e=window.location.hostname;if(e.includes("emergentagent.com")||e.includes("preview.emergentagent.com"))return window.location.origin;if(e.includes("vercel.app")||e.includes("wedlive.vercel.app"))return"https://wedlive.onrender.com";e.includes("localhost")||e.includes("127.0.0.1")}return"http://localhost:8001"})(),TIMEOUT:3e5,RETRY_ATTEMPTS:2,RETRY_DELAY:1e3},MEDIA:{PROXY_ENDPOINT:"/api/media/telegram-proxy/photos/",SUPPORTED_FORMATS:["jpg","jpeg","png","webp"],MAX_FILE_SIZE:10485760},IMAGE:{MAX_RETRIES:2,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3,LOADING_PLACEHOLDER:"/images/placeholder.jpg"}},o=()=>l.API.BASE_URL,n=()=>{let e=o(),a=e.includes("localhost"),t=r();return console.log("\uD83D\uDD27 Configuration Validation:",{apiBaseUrl:e,environment:t?"production":"development",isLocal:a,mediaProxy:l.MEDIA.PROXY_ENDPOINT}),t&&a&&(console.error("❌ ERROR: Production frontend using localhost backend URL!"),console.error("Update NEXT_PUBLIC_API_URL in Vercel environment variables to: https://wedlive.onrender.com")),e.includes("8000")&&console.warn("⚠️ WARNING: API base URL is using port 8000, expected 8001 for local or 443 for production"),!0};a.ZP=l},77700:function(e,a,t){"use strict";t.d(a,{cn:function(){return l}});var s=t(44839),r=t(96164);function l(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,s.W)(a))}}},function(e){e.O(0,[9767,4868,2151,7553,1134,2971,7023,1744],function(){return e(e.s=75337)}),_N_E=e.O()}]);