(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3770,6657],{35044:function(e,t,r){Promise.resolve().then(r.bind(r,37804))},37804:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var o=r(57437),n=r(2265),a=r(16463),s=r(15730),l=r(10273),i=r(3274),c=r(92940),u=r(71935),d=r(27776),g=r(38472);let m=(0,r(78614).bR)();function f(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{setUser:r,setToken:f}=(0,s.a)(),[p,h]=(0,n.useState)("processing"),[x,v]=(0,n.useState)("Completing Google sign in...");return(0,n.useEffect)(()=>{(async()=>{try{let o=t.get("code"),n=t.get("state"),a=t.get("error");if(a){h("error"),v("Google authentication failed: ".concat(a)),d.toast.error("Google sign in failed"),setTimeout(()=>e.push("/login"),3e3);return}if(!o){h("error"),v("No authorization code received"),d.toast.error("Invalid callback"),setTimeout(()=>e.push("/login"),3e3);return}let s=localStorage.getItem("google_oauth_state");if(n&&s&&n!==s){h("error"),v("Invalid state token. Possible CSRF attack."),d.toast.error("Security error"),setTimeout(()=>e.push("/login"),3e3);return}v("Verifying with Google...");let{access_token:l,user:i}=(await g.Z.post("".concat(m,"/api/auth/google/callback"),{code:o,state:n})).data;localStorage.setItem("token",l),localStorage.removeItem("google_oauth_state"),f(l),r(i),h("success"),v("Successfully signed in with Google!"),d.toast.success("Welcome to WedLive!"),setTimeout(()=>e.push("/dashboard"),1500)}catch(t){var o,n;console.error("Google callback error:",t),h("error"),v((null===(n=t.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to complete Google sign in"),d.toast.error("Authentication failed"),setTimeout(()=>e.push("/login"),3e3)}})()},[t,e,r,f]),(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center p-4",children:(0,o.jsx)(l.Zb,{className:"w-full max-w-md border-2 shadow-lg",children:(0,o.jsx)(l.aY,{className:"pt-6",children:(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:["processing"===p&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.Z,{className:"w-16 h-16 text-rose-500 animate-spin"}),(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Processing..."}),(0,o.jsx)("p",{className:"text-sm text-gray-600 text-center",children:x})]}),"success"===p&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{className:"w-16 h-16 text-green-500"}),(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Success!"}),(0,o.jsx)("p",{className:"text-sm text-gray-600 text-center",children:x}),(0,o.jsx)("p",{className:"text-xs text-gray-500",children:"Redirecting to dashboard..."})]}),"error"===p&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.Z,{className:"w-16 h-16 text-red-500"}),(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Error"}),(0,o.jsx)("p",{className:"text-sm text-gray-600 text-center",children:x}),(0,o.jsx)("p",{className:"text-xs text-gray-500",children:"Redirecting to login..."})]})]})})})})}function p(){return(0,o.jsx)(n.Suspense,{fallback:(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center",children:(0,o.jsx)(i.Z,{className:"w-16 h-16 text-rose-500 animate-spin"})}),children:(0,o.jsx)(f,{})})}},10273:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return s},aY:function(){return u},eW:function(){return d},ll:function(){return i}});var o=r(57437),n=r(2265),a=r(77700);let s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...n})});s.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});l.displayName="CardHeader";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",r),...n})});i.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})});c.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});u.displayName="CardContent";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})});d.displayName="CardFooter"},6657:function(e,t,r){"use strict";r.r(t);var o=r(38472),n=r(78614);(0,n.ww)(),console.log("API Base URL:",(0,n.bR)());let a=o.Z.create({baseURL:(0,n.bR)(),headers:{"Content-Type":"application/json"},timeout:n.ZP.API.TIMEOUT});a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),a.interceptors.response.use(e=>e,async e=>{var t,r,o,s,l,i,c;let u=e.config;if(console.error("API Error:",e),"ECONNABORTED"===e.code||"Network Error"===e.message){if(u.__retryCount||(u.__retryCount=0),u.__retryCount<n.ZP.API.RETRY_ATTEMPTS)return u.__retryCount+=1,console.warn("Retrying request (".concat(u.__retryCount,"/").concat(n.ZP.API.RETRY_ATTEMPTS,")...")),await new Promise(e=>setTimeout(e,n.ZP.API.RETRY_DELAY*u.__retryCount)),a(u);console.error("Request timeout after retries - API might be down")}if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("❌ Authentication failed - token expired or invalid"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(s=window.toast)||void 0===s||s.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true"),(null===(r=e.response)||void 0===r?void 0:r.status)===403){console.error("❌ Access forbidden - you may not have permission or your session expired");let t=(null===(i=e.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:l.detail)||"";(t.toLowerCase().includes("not authorized")||t.toLowerCase().includes("permission"))&&(console.warn("⚠️ Token may be expired - redirecting to login"),localStorage.removeItem("token"),localStorage.removeItem("user"),void 0!==window.toast&&(null===(c=window.toast)||void 0===c||c.error("Your session has expired. Please log in again.")),window.location.href="/login?expired=true")}return(null===(o=e.response)||void 0===o?void 0:o.status)===404&&console.error("Resource not found - check API endpoint"),Promise.reject(e)}),t.default=a},15730:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return c}});var o=r(57437),n=r(2265),a=r(6657);let s=(0,n.createContext)({});function l(e){if(!e)return!0;let t=function(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(r)}catch(e){return console.error("Failed to decode JWT:",e),null}}(e);return!t||!t.exp||1e3*t.exp-Date.now()<3e5}let i=e=>{let{children:t}=e,[r,i]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[d,g]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(l(e)?(console.warn("⚠️ JWT token expired - clearing auth state"),localStorage.removeItem("token"),localStorage.removeItem("user"),u(null),i(null)):(u(e),i(JSON.parse(t)))),g(!1)},[]);let m=async(e,t)=>{let{access_token:r,user:o}=(await a.default.post("/api/auth/login",{email:e,password:t})).data;return localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(o)),u(r),i(o),o},f=async(e,t,r)=>{let{access_token:o,user:n}=(await a.default.post("/api/auth/register",{email:e,password:t,full_name:r})).data;return localStorage.setItem("token",o),localStorage.setItem("user",JSON.stringify(n)),u(o),i(n),n},p=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),u(null),i(null),window.location.href="/"},h=async()=>{try{let e=(await a.default.get("/api/auth/me")).data;return localStorage.setItem("user",JSON.stringify(e)),i(e),e}catch(t){var e;return console.error("Failed to refresh user data:",t),(null===(e=t.response)||void 0===e?void 0:e.status)===401&&(console.error("❌ Token invalid - logging out"),p()),null}};return(0,n.useEffect)(()=>{if(!c)return;let e=setInterval(()=>{l(c)&&(console.warn("⚠️ JWT token expired - logging out"),p())},6e4);return()=>clearInterval(e)},[c]),(0,o.jsx)(s.Provider,{value:{user:r,token:c,setToken:u,setUser:i,login:m,register:f,logout:p,refreshUser:h,loading:d,isTokenExpired:()=>l(c)},children:t})},c=()=>(0,n.useContext)(s)},78614:function(e,t,r){"use strict";r.d(t,{bR:function(){return s},ww:function(){return l}});var o=r(20357);let n=()=>{{let e=window.location.hostname;return e.includes("vercel.app")||e.includes("wedlive.vercel.app")}},a={API:{BASE_URL:(()=>{let e=o.env.NEXT_PUBLIC_BACKEND_URL||o.env.REACT_APP_BACKEND_URL||o.env.NEXT_PUBLIC_API_URL;if(e)return e;{let e=window.location.hostname;if(e.includes("emergentagent.com")||e.includes("preview.emergentagent.com"))return window.location.origin;if(e.includes("vercel.app")||e.includes("wedlive.vercel.app"))return"https://wedlive.onrender.com";e.includes("localhost")||e.includes("127.0.0.1")}return"http://localhost:8001"})(),TIMEOUT:3e5,RETRY_ATTEMPTS:2,RETRY_DELAY:1e3},MEDIA:{PROXY_ENDPOINT:"/api/media/telegram-proxy/photos/",SUPPORTED_FORMATS:["jpg","jpeg","png","webp"],MAX_FILE_SIZE:10485760},IMAGE:{MAX_RETRIES:2,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3,LOADING_PLACEHOLDER:"/images/placeholder.jpg"}},s=()=>a.API.BASE_URL,l=()=>{let e=s(),t=e.includes("localhost"),r=n();return console.log("\uD83D\uDD27 Configuration Validation:",{apiBaseUrl:e,environment:r?"production":"development",isLocal:t,mediaProxy:a.MEDIA.PROXY_ENDPOINT}),r&&t&&(console.error("❌ ERROR: Production frontend using localhost backend URL!"),console.error("Update NEXT_PUBLIC_API_URL in Vercel environment variables to: https://wedlive.onrender.com")),e.includes("8000")&&console.warn("⚠️ WARNING: API base URL is using port 8000, expected 8001 for local or 443 for production"),!0};t.ZP=a},77700:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var o=r(44839),n=r(96164);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,o.W)(t))}},92940:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(78030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},71935:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(78030).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},3274:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(78030).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[9767,4868,7776,2971,7023,1744],function(){return e(e.s=35044)}),_N_E=e.O()}]);