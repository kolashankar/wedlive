(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1297],{3903:function(e,t,s){Promise.resolve().then(s.bind(s,81398))},81398:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(57437),r=s(2265),l=s(16463),c=s(38472),i=s(27776);let n=(0,s(78030).Z)("webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);var o=s(92513),d=s(92940),x=s(71935),u=s(40933),h=s(24841),g=s(98094),m=s(75733),p=s(10883);let y=s(20357).env.NEXT_PUBLIC_API_URL||"http://localhost:8001/api",b=[{value:"stream.started",label:"Stream Started",description:"Triggered when a stream goes live"},{value:"stream.ended",label:"Stream Ended",description:"Triggered when a stream ends"},{value:"recording.ready",label:"Recording Ready",description:"Triggered when recording is ready"},{value:"viewer.joined",label:"Viewer Joined",description:"Triggered when a viewer joins"},{value:"wedding.created",label:"Wedding Created",description:"Triggered when a wedding is created"},{value:"wedding.updated",label:"Wedding Updated",description:"Triggered when wedding details are updated"}];function v(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)(null),[v,f]=(0,r.useState)([]),[j,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(!1),[Z,C]=(0,r.useState)(null),[S,_]=(0,r.useState)([]),[z,W]=(0,r.useState)({url:"",events:[],description:""});(0,r.useEffect)(()=>{if(!localStorage.getItem("token")){e.push("/login");return}A(),L()},[]);let A=async()=>{try{let t=localStorage.getItem("token"),a=await c.Z.get("".concat(y,"/auth/me"),{headers:{Authorization:"Bearer ".concat(t)}});s(a.data),"free"===a.data.subscription_plan&&(i.toast.error("Premium subscription required"),e.push("/pricing"))}catch(t){console.error("Failed to fetch user data:",t),e.push("/login")}},L=async()=>{try{let e=localStorage.getItem("token"),t=await c.Z.get("".concat(y,"/premium/webhooks"),{headers:{Authorization:"Bearer ".concat(e)}});f(t.data.webhooks||[])}catch(e){console.error("Failed to fetch webhooks:",e)}},I=async()=>{if(!z.url.trim()){i.toast.error("Please enter webhook URL");return}if(0===z.events.length){i.toast.error("Please select at least one event");return}N(!0);try{let e=localStorage.getItem("token");await c.Z.post("".concat(y,"/premium/webhooks"),z,{headers:{Authorization:"Bearer ".concat(e)}}),i.toast.success("Webhook created successfully!"),k(!1),W({url:"",events:[],description:""}),L()}catch(s){var e,t;i.toast.error((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||"Failed to create webhook")}finally{N(!1)}},B=async(e,t)=>{let s="active"===t?"paused":"active";try{let t=localStorage.getItem("token");await c.Z.put("".concat(y,"/premium/webhooks/").concat(e),{status:s},{headers:{Authorization:"Bearer ".concat(t)}}),i.toast.success("Webhook ".concat("active"===s?"activated":"paused")),L()}catch(e){i.toast.error("Failed to update webhook status")}},F=async e=>{if(confirm("Are you sure you want to delete this webhook?"))try{let t=localStorage.getItem("token");await c.Z.delete("".concat(y,"/premium/webhooks/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}}),i.toast.success("Webhook deleted successfully"),L()}catch(e){i.toast.error("Failed to delete webhook")}},M=async e=>{C(e);try{let t=localStorage.getItem("token"),s=await c.Z.get("".concat(y,"/premium/webhooks/").concat(e.id,"/logs"),{headers:{Authorization:"Bearer ".concat(t)}});_(s.data.logs||[])}catch(e){console.error("Failed to fetch logs:",e),_([])}},P=e=>{z.events.includes(e)?W({...z,events:z.events.filter(t=>t!==e)}):W({...z,events:[...z.events,e]})};return t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,a.jsx)(n,{className:"w-8 h-8 text-indigo-600"}),"Webhooks"]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Receive real-time notifications about events"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>e.push("/settings"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Back to Settings"}),(0,a.jsxs)("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),"Create Webhook"]})]})]})})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:0===v.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(n,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No webhooks configured"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Create a webhook to receive real-time notifications"}),(0,a.jsx)("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Create Webhook"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:v.map(e=>(0,a.jsx)("div",{className:"p-6 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.description||"Webhook"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 font-mono bg-gray-100 px-3 py-1 rounded inline-block mb-2",children:e.url}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:e.events.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 rounded text-xs",children:e},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-green-600"}),e.success_count," successes"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 text-red-600"}),e.failure_count," failures"]}),e.last_triggered&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"Last: ",new Date(e.last_triggered).toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>B(e.id,e.status),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg",title:"active"===e.status?"Pause":"Activate",children:"active"===e.status?(0,a.jsx)(h.Z,{className:"w-5 h-5"}):(0,a.jsx)(g.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>M(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"View logs",children:(0,a.jsx)(m.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>F(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",title:"Delete",children:(0,a.jsx)(p.Z,{className:"w-5 h-5"})})]})]})},e.id))})})}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 my-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Create Webhook"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Webhook URL *"}),(0,a.jsx)("input",{type:"url",value:z.url,onChange:e=>W({...z,url:e.target.value}),placeholder:"https://your-api.com/webhook",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("input",{type:"text",value:z.description,onChange:e=>W({...z,description:e.target.value}),placeholder:"e.g., Production webhook",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Events to Subscribe *"}),(0,a.jsx)("div",{className:"space-y-2",children:b.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"checkbox",id:e.value,checked:z.events.includes(e.value),onChange:()=>P(e.value),className:"mt-1 w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:e.value,className:"text-sm font-medium text-gray-900 cursor-pointer",children:e.label}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.value))})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{onClick:()=>{k(!1),W({url:"",events:[],description:""})},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"}),(0,a.jsx)("button",{onClick:I,disabled:j||!z.url.trim()||0===z.events.length,className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:j?"Creating...":"Create Webhook"})]})]})]})}),Z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 my-8 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Webhook Logs"}),(0,a.jsx)("button",{onClick:()=>{C(null),_([])},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:Z.url}),0===S.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No logs available yet"}):(0,a.jsx)("div",{className:"space-y-3",children:S.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.success?"Success":"Failed"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.event}),e.status_code>0&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Status: ",e.status_code]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]}),e.response&&(0,a.jsx)("div",{className:"mt-2 bg-gray-900 text-green-400 p-3 rounded text-xs font-mono overflow-x-auto",children:e.response})]},t))})]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})})}},92940:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},71935:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},40933:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},75733:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},24841:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]])},98094:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},92513:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},10883:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(78030).Z)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[9767,7776,2971,7023,1744],function(){return e(e.s=3903)}),_N_E=e.O()}]);