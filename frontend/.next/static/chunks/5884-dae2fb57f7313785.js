"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5884],{91231:function(e,t,o){o.d(t,{Z:function(){return l}});var a=o(57437),i=o(2265),r=o(3274);function l(e){let{photoUrl:t,src:l,borderUrl:n,maskUrl:s,maskData:d,aspectRatio:c="4:5",width:u,height:h,className:m="",alt:p="Photo",onLoad:v,onError:g,shadow:f=!0,position:y="center"}=e,[x,w]=(0,i.useState)(!0),[b,_]=(0,i.useState)(!1),E=(0,i.useRef)(null),V=e=>{if(!e||"string"!=typeof e||""===e.trim())return null;if(e.startsWith("/")){let t=o(78614).ZP;return"".concat(t.API.BASE_URL).concat(e)}return e},T=V(t||l),j=V(n||s),P=e=>({"4:5":"4/5","1:1":"1/1","16:9":"16/9","3:4":"3/4","2:3":"2/3"})[e]||e;return(0,a.jsxs)("div",{ref:E,className:"photo-frame relative w-full ".concat(m),style:(()=>{let e={overflow:"visible",position:"relative",minWidth:0,minHeight:0,backgroundColor:"transparent",isolation:"isolate",transform:"translateZ(0)",display:"block",width:"100%",objectFit:"contain"};if(u&&h)return{...e,width:"".concat(u,"px"),height:"".concat(h,"px"),maxWidth:"100%",aspectRatio:"".concat(u,"/").concat(h)};let t=P(c);return{...e,aspectRatio:t,width:"100%",height:"auto",maxHeight:"100vh"}})(),children:[(0,a.jsx)("div",{className:"absolute inset-0",style:{overflow:"hidden",zIndex:1,backgroundColor:"transparent",borderRadius:"inherit"},children:T&&(0,a.jsx)("img",{src:T,alt:p,className:"absolute inset-0 w-full h-full",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",objectPosition:y,willChange:"auto",backfaceVisibility:"hidden"},onLoad:e=>{w(!1),_(!1),v&&v(e)},onError:e=>{w(!1),_(!0),g&&g(e)}})}),j&&(0,a.jsx)("img",{src:j,alt:"Border",className:"absolute pointer-events-none",style:{position:"absolute",top:"-25%",left:"-25%",right:"-25%",bottom:"-25%",width:"calc(100% + 50%)",height:"calc(100% + 50%)",maxWidth:"none",maxHeight:"none",zIndex:50,objectFit:"fill",objectPosition:"center",pointerEvents:"none",background:"none",backgroundColor:"transparent",mixBlendMode:"normal",opacity:1,willChange:"auto",backfaceVisibility:"hidden",display:"block"},onLoad:()=>{},onError:()=>{}}),x&&!b&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-transparent z-10",children:(0,a.jsx)(r.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}),b&&(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-transparent z-10 p-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-2 bg-gray-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Photo unavailable"})]})})]})}},47870:function(e,t,o){o.d(t,{Z:function(){return s}});var a=o(57437),i=o(2265),r=o(3274),l=o(6657),n=o(38358);function s(e){var t,o,s;let{weddingId:d,className:c=""}=e,[u,h]=(0,i.useState)(null),[m,p]=(0,i.useState)(!0),[v,g]=(0,i.useState)(null),[f,y]=(0,i.useState)({width:0,height:0}),[x,w]=(0,i.useState)({width:0,height:0}),[b,_]=(0,i.useState)({width:0,height:0,offsetX:0,offsetY:0}),[E,V]=(0,i.useState)(0),[T,j]=(0,i.useState)(0),P=(0,i.useRef)(null),S=(0,i.useRef)(null);(0,i.useEffect)(()=>{N()},[d]);let N=async()=>{var e,t;try{p(!0),g(null);let t=(await l.default.get("/api/viewer/wedding/".concat(d,"/all"))).data.video_template;if(t&&t.id){console.log("[TemplateVideoPlayer] ========== VIDEO TEMPLATE DEBUG =========="),console.log("[TemplateVideoPlayer] Video template loaded from viewer endpoint:",t),console.log("[TemplateVideoPlayer] Video URL:",t.video_url),console.log("[TemplateVideoPlayer] Overlays count:",(null===(e=t.text_overlays)||void 0===e?void 0:e.length)||0),t.text_overlays&&t.text_overlays.length>0?(console.log("[TemplateVideoPlayer] ========== OVERLAY DEBUG =========="),t.text_overlays.forEach((e,t)=>{console.log("[TemplateVideoPlayer] Overlay ".concat(t,":"),{id:e.id,label:e.label,text:e.text,text_value:e.text_value,position:e.position,timing:e.timing,hasText:!!(e.text||e.text_value)})})):console.warn("[TemplateVideoPlayer] ⚠️ NO OVERLAYS FOUND IN RESPONSE!");let o={assignment_id:t.id,template:{id:t.id,name:t.name,video_data:{original_url:t.video_url,width:t.resolution?parseInt(t.resolution.split("x")[0]):null,height:t.resolution?parseInt(t.resolution.split("x")[1]):null},reference_resolution:t.reference_resolution||(t.resolution?{width:parseInt(t.resolution.split("x")[0]),height:parseInt(t.resolution.split("x")[1])}:{width:720,height:1280}),duration:t.duration||0},populated_overlays:t.text_overlays||[]};console.log("[TemplateVideoPlayer] Mapped data:",{hasTemplate:!!o.template,overlaysCount:o.populated_overlays.length,firstOverlay:o.populated_overlays[0]}),h(o)}else console.log("[TemplateVideoPlayer] No template assigned to this wedding"),h(null)}catch(e){console.error("[TemplateVideoPlayer] Failed to load template:",e),console.error("[TemplateVideoPlayer] Error details:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),g("Failed to load video template")}finally{p(!1)}};if((0,i.useEffect)(()=>{let e=P.current;if(!e)return;let t=null,o=()=>{!e||e.paused||e.ended||(V(e.currentTime),t=requestAnimationFrame(o))},a=()=>{t=requestAnimationFrame(o)},i=()=>{t&&(cancelAnimationFrame(t),t=null),V(e.currentTime)},r=()=>{y({width:e.videoWidth,height:e.videoHeight}),j(e.duration),console.log("[TemplateVideoPlayer] Video metadata loaded:",{width:e.videoWidth,height:e.videoHeight,duration:e.duration})},l=()=>{(e.paused||e.ended)&&V(e.currentTime)},n=e=>{console.error("[TemplateVideoPlayer] Video load error:",e),console.error("[TemplateVideoPlayer] Error details:",{error:e.target.error,networkState:e.target.networkState,readyState:e.target.readyState,currentSrc:e.target.currentSrc,src:e.target.src}),g("Video failed to load. The video file may be unavailable or the URL is invalid.")};return e.addEventListener("play",a),e.addEventListener("pause",i),e.addEventListener("loadedmetadata",r),e.addEventListener("timeupdate",l),e.addEventListener("error",n),e.paused||e.ended||(t=requestAnimationFrame(o)),()=>{t&&cancelAnimationFrame(t),e.removeEventListener("play",a),e.removeEventListener("pause",i),e.removeEventListener("loadedmetadata",r),e.removeEventListener("timeupdate",l),e.removeEventListener("error",n)}},[u]),(0,i.useEffect)(()=>{let e=()=>{if(S.current){let e=S.current.getBoundingClientRect();w({width:e.width,height:e.height})}};e();let t=new ResizeObserver(e);return S.current&&t.observe(S.current),()=>{t.disconnect()}},[]),(0,i.useEffect)(()=>{if(!x.width||!x.height||!f.width||!f.height)return;let e=x.width/x.height,t=f.width/f.height,o,a,i=0,r=0;t>e?(o=x.width,a=x.width/t,r=(x.height-a)/2):(a=x.height,o=x.height*t,i=(x.width-o)/2),_({width:o,height:a,offsetX:i,offsetY:r})},[x,f]),m)return(0,a.jsx)("div",{className:"flex items-center justify-center ".concat(c),children:(0,a.jsx)(r.Z,{className:"w-8 h-8 animate-spin text-gray-400 opacity-50"})});if(v||!u||!u.template)return null;let k=u.template,L=u.populated_overlays||[],R=null===(t=k.video_data)||void 0===t?void 0:t.original_url,C=k.duration||0;if(!R)return null;let I=k.reference_resolution||((null===(o=k.video_data)||void 0===o?void 0:o.width)&&(null===(s=k.video_data)||void 0===s?void 0:s.height)?{width:k.video_data.width,height:k.video_data.height}:{width:1920,height:1080});return console.log("[TemplateVideoPlayer] Render state:",{overlaysCount:L.length,renderedVideoSize:b,videoSize:f,containerSize:x,currentTime:E,duration:T,canRenderOverlays:L.length>0&&b.width>0}),(0,a.jsxs)("div",{ref:S,className:"relative ".concat(c),children:[(0,a.jsx)("video",{ref:P,src:R,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,preload:"auto",className:"w-full h-full object-contain",style:{backgroundColor:"transparent",mixBlendMode:"normal"},onError:e=>{console.error("[TemplateVideoPlayer] Video element error:",{videoUrl:R,error:e.currentTarget.error,networkState:e.currentTarget.networkState})},onLoadStart:()=>{console.log("[TemplateVideoPlayer] Video load started:",R)},onCanPlay:()=>{console.log("[TemplateVideoPlayer] Video can play")}}),L.length>0&&(b.width>0?(0,a.jsx)("div",{className:"absolute pointer-events-none",style:{left:"".concat(b.offsetX,"px"),top:"".concat(b.offsetY,"px"),width:"".concat(b.width,"px"),height:"".concat(b.height,"px"),position:"absolute",zIndex:10},children:L.map((e,t)=>(console.log("[TemplateVideoPlayer] Rendering overlay:",{id:e.id,text_value:e.text_value,position:e.position,timing:e.timing,currentTime:E,duration:T}),(0,a.jsx)(n.Z,{overlay:e,currentTime:E,duration:T,containerSize:b,referenceResolution:I,templateDuration:C},e.id||t)))}):(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{position:"absolute",zIndex:10,width:"100%",height:"100%"},children:L.map((e,t)=>{console.log("[TemplateVideoPlayer] Rendering overlay (fallback mode):",{id:e.id,text_value:e.text_value,currentTime:E,duration:T});let o={width:x.width||720,height:x.height||1280,offsetX:0,offsetY:0};return(0,a.jsx)(n.Z,{overlay:e,currentTime:E,duration:T,containerSize:o,referenceResolution:I,templateDuration:C},e.id||t)})}))]})}}}]);