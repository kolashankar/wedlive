"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9178],{19178:function(e,t,n){n.d(t,{Z:function(){return v}});var s=n(57437),r=n(2265),a=n(56360),o=n(95640),i=n(10273),l=n(17953),c=n(55636),d=n(59791),m=n(99913),u=n(10883),g=n(60994),p=n(47390),x=n(3274),f=n(27776),h=n(6657),_=n(15730),w=n(67783),y=n(87568);function j(e){var t,n;let{comment:i,onReply:l,onLike:p,onDelete:x,onEdit:f,currentUserId:h,depth:_=0}=e,[w,v]=(0,r.useState)(!0),[N,C]=(0,r.useState)(!1),[b,D]=(0,r.useState)(!1),[k,S]=(0,r.useState)(i.comment),[E,R]=(0,r.useState)(""),[F,q]=(0,r.useState)(!1),z=h===i.user_id,Z=i.replies&&i.replies.length>0;(0,r.useEffect)(()=>{q(!0)},[]);let A=async e=>{e.preventDefault(),E.trim()&&(await l(i.id,E),R(""),C(!1))},I=async()=>{k.trim()&&(await f(i.id,k),D(!1))};return(0,s.jsx)("div",{className:"".concat(_>0?"ml-12 mt-4":"mt-6"),children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)(o.qE,{className:"w-10 h-10",children:[(0,s.jsx)(o.F$,{src:i.user_avatar}),(0,s.jsx)(o.Q5,{className:"bg-gradient-to-br from-rose-500 to-purple-600 text-white",children:(null===(n=i.user_name)||void 0===n?void 0:null===(t=n.charAt(0))||void 0===t?void 0:t.toUpperCase())||"U"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"font-semibold text-sm",children:i.user_name}),F&&(0,s.jsx)("span",{className:"text-xs text-gray-500",suppressHydrationWarning:!0,children:(0,y.Q)(new Date(i.created_at),{addSuffix:!0})}),i.updated_at&&(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),b?(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("textarea",{value:k,onChange:e=>S(e.target.value),className:"w-full p-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-rose-500",rows:3}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)(a.z,{size:"sm",onClick:I,children:"Save"}),(0,s.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{S(i.comment),D(!1)},children:"Cancel"})]})]}):(0,s.jsx)("p",{className:"text-sm text-gray-800 mb-2 whitespace-pre-wrap",children:i.comment}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("button",{onClick:()=>p(i.id),className:"flex items-center gap-1 text-sm transition-colors ".concat(i.is_liked_by_user?"text-rose-600 font-semibold":"text-gray-600 hover:text-rose-600"),children:[(0,s.jsx)(c.Z,{className:"w-4 h-4 ".concat(i.is_liked_by_user?"fill-rose-600":"")}),(0,s.jsx)("span",{children:i.likes_count>0?i.likes_count:"Like"})]}),_<2&&(0,s.jsxs)("button",{onClick:()=>C(!N),className:"flex items-center gap-1 text-sm text-gray-600 hover:text-rose-600 transition-colors",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Reply"})]}),z&&!b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>D(!0),className:"flex items-center gap-1 text-sm text-gray-600 hover:text-blue-600 transition-colors",children:[(0,s.jsx)(m.Z,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:"Edit"})]}),(0,s.jsxs)("button",{onClick:()=>x(i.id),className:"flex items-center gap-1 text-sm text-gray-600 hover:text-red-600 transition-colors",children:[(0,s.jsx)(u.Z,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:"Delete"})]})]})]}),N&&(0,s.jsx)("form",{onSubmit:A,className:"mt-3",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:E,onChange:e=>R(e.target.value),placeholder:"Write a reply...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-rose-500",autoFocus:!0}),(0,s.jsx)(a.z,{type:"submit",size:"sm",disabled:!E.trim(),children:(0,s.jsx)(g.Z,{className:"w-4 h-4"})})]})}),Z&&(0,s.jsx)("div",{className:"mt-3",children:i.replies.map(e=>(0,s.jsx)(j,{comment:e,onReply:l,onLike:p,onDelete:x,onEdit:f,currentUserId:h,depth:_+1},e.id))})]})]})})}function v(e){var t,n;let{weddingId:c}=e,{user:d}=(0,_.a)(),{socket:m}=(0,w.s)(),[u,g]=(0,r.useState)([]),[y,v]=(0,r.useState)(""),[N,C]=(0,r.useState)(!0),[b,D]=(0,r.useState)(!1),k=(0,r.useRef)(null);(0,r.useEffect)(()=>{S()},[c]),(0,r.useEffect)(()=>{if(m&&c)return m.emit("join_wedding",{wedding_id:c}),m.on("new_comment",e=>{e.wedding_id===c&&g(t=>[e.comment,...t])}),m.on("comment_liked",e=>{e.wedding_id===c&&E(e.comment_id,e.likes_count)}),m.on("comment_updated",e=>{e.wedding_id===c&&R(e.comment_id,e.comment)}),m.on("comment_deleted",e=>{e.wedding_id===c&&F(e.comment_id)}),()=>{m.off("new_comment"),m.off("comment_liked"),m.off("comment_updated"),m.off("comment_deleted"),m.emit("leave_wedding",{wedding_id:c})}},[m,c]);let S=async()=>{try{C(!0);let e=await h.default.get("/api/comments?weddingId=".concat(c));g(e.data)}catch(e){console.error("Error loading comments:",e),f.toast.error("Failed to load comments")}finally{C(!1)}},E=(e,t)=>{g(n=>q(n,e,{likes_count:t}))},R=(e,t)=>{g(n=>q(n,e,{comment:t,updated_at:new Date().toISOString()}))},F=e=>{g(t=>t.filter(t=>t.id!==e).map(t=>{var n;return{...t,replies:(null===(n=t.replies)||void 0===n?void 0:n.filter(t=>t.id!==e))||[]}}))},q=(e,t,n)=>e.map(e=>e.id===t?{...e,...n}:e.replies&&e.replies.length>0?{...e,replies:q(e.replies,t,n)}:e),z=async e=>{if(e.preventDefault(),y.trim()){if(!d){f.toast.error("Please log in to comment");return}try{D(!0),await h.default.post("/api/comments",{wedding_id:c,comment:y,parent_comment_id:null}),v("")}catch(e){var t,n;console.error("Error posting comment:",e),f.toast.error((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.detail)||"Failed to post comment")}finally{D(!1)}}},Z=async(e,t)=>{if(!d){f.toast.error("Please log in to reply");return}try{await h.default.post("/api/comments",{wedding_id:c,comment:t,parent_comment_id:e})}catch(e){console.error("Error posting reply:",e),f.toast.error("Failed to post reply")}},A=async e=>{if(!d){f.toast.error("Please log in to like comments");return}try{await h.default.post("/api/comments/".concat(e,"/like"))}catch(e){console.error("Error liking comment:",e),f.toast.error("Failed to like comment")}},I=async(e,t)=>{try{await h.default.put("/api/comments/".concat(e),{comment:t}),f.toast.success("Comment updated")}catch(e){console.error("Error editing comment:",e),f.toast.error("Failed to edit comment")}},U=async e=>{if(confirm("Are you sure you want to delete this comment?"))try{await h.default.delete("/api/comments/".concat(e)),f.toast.success("Comment deleted")}catch(e){console.error("Error deleting comment:",e),f.toast.error("Failed to delete comment")}};return(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5"}),"Comments (",u.length,")"]})}),(0,s.jsxs)(i.aY,{children:[d?(0,s.jsx)("form",{onSubmit:z,className:"mb-6",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)(o.qE,{className:"w-10 h-10",children:[(0,s.jsx)(o.F$,{src:d.avatar_url}),(0,s.jsx)(o.Q5,{className:"bg-gradient-to-br from-rose-500 to-purple-600 text-white",children:(null===(n=d.full_name)||void 0===n?void 0:null===(t=n.charAt(0))||void 0===t?void 0:t.toUpperCase())||"U"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"Add a comment...",className:"w-full p-3 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-rose-500 resize-none",rows:3}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,s.jsx)(a.z,{type:"button",variant:"outline",size:"sm",onClick:()=>v(""),disabled:!y.trim(),children:"Cancel"}),(0,s.jsx)(a.z,{type:"submit",size:"sm",disabled:!y.trim()||b,children:b?(0,s.jsx)(x.Z,{className:"w-4 h-4 animate-spin"}):"Comment"})]})]})]})}):(0,s.jsx)("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-md text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Please ",(0,s.jsx)("a",{href:"/login",className:"text-rose-600 hover:underline font-semibold",children:"log in"})," to leave a comment"]})}),(0,s.jsx)(l.Z,{className:"mb-6"}),N?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)(x.Z,{className:"w-6 h-6 animate-spin text-rose-500"})}):0===u.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(p.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),(0,s.jsx)("p",{className:"text-gray-500",children:"No comments yet"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Be the first to share your thoughts!"})]}):(0,s.jsx)("div",{className:"space-y-1",children:u.map(e=>(0,s.jsx)(j,{comment:e,onReply:Z,onLike:A,onDelete:U,onEdit:I,currentUserId:null==d?void 0:d.id,depth:0},e.id))}),(0,s.jsx)("div",{ref:k})]})]})}},95640:function(e,t,n){n.d(t,{F$:function(){return l},Q5:function(){return c},qE:function(){return i}});var s=n(57437),r=n(2265),a=n(93269),o=n(77700);let i=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.fC,{ref:t,className:(0,o.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...r})});i.displayName=a.fC.displayName;let l=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.Ee,{ref:t,className:(0,o.cn)("aspect-square h-full w-full",n),...r})});l.displayName=a.Ee.displayName;let c=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.NY,{ref:t,className:(0,o.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...r})});c.displayName=a.NY.displayName},17953:function(e,t,n){n.d(t,{Z:function(){return i}});var s=n(57437),r=n(2265),a=n(70325),o=n(77700);let i=r.forwardRef((e,t)=>{let{className:n,orientation:r="horizontal",decorative:i=!0,...l}=e;return(0,s.jsx)(a.f,{ref:t,decorative:i,orientation:r,className:(0,o.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",n),...l})});i.displayName=a.f.displayName},67783:function(e,t,n){n.d(t,{s:function(){return d},w:function(){return c}});var s=n(57437),r=n(2265),a=n(45040),o=n(20357);let i=(0,r.createContext)(null),l=o.env.NEXT_PUBLIC_SOCKET_URL||o.env.NEXT_PUBLIC_API_URL||"http://localhost:8001";function c(e){let{children:t,weddingId:n}=e,o=(0,r.useRef)(null),[c,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(0),[g,p]=(0,r.useState)([]),[x,f]=(0,r.useState)([]),[h,_]=(0,r.useState)(null),[w,y]=(0,r.useState)(null),[j,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!n)return;console.log("\uD83D\uDD0C Connecting to Socket.IO server:",l),o.current=(0,a.io)(l,{transports:["websocket","polling"],withCredentials:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,path:"/socket.io/",secure:l.startsWith("https")});let e=o.current;return e.on("connect",()=>{console.log("✅ Socket connected:",e.id),d(!0),e.emit("join_wedding",{wedding_id:n,guest_name:localStorage.getItem("guest_name")||"Anonymous"})}),e.on("disconnect",()=>{console.log("❌ Socket disconnected"),d(!1)}),e.on("connect_error",e=>{console.error("\uD83D\uDD34 Socket connection error:",e)}),e.on("viewer_count",e=>{e.wedding_id===n&&(console.log("\uD83D\uDC65 Viewer count updated:",e.count),u(e.count))}),e.on("new_message",e=>{e.wedding_id===n&&(console.log("\uD83D\uDCAC New message received:",e),p(t=>[...t,e]))}),e.on("new_reaction",e=>{e.wedding_id===n&&(console.log("❤️ New reaction:",e.emoji),f(t=>[...t,e]),setTimeout(()=>{f(t=>t.filter(t=>t.timestamp!==e.timestamp))},3e3))}),e.on("recording_started",e=>{e.wedding_id===n&&(console.log("\uD83D\uDCF9 Recording started:",e),_({status:"recording",recording_id:e.recording_id,started_at:e.started_at,quality:e.quality}))}),e.on("recording_completed",e=>{e.wedding_id===n&&(console.log("✅ Recording completed:",e),_({status:"completed",recording_id:e.recording_id,recording_url:e.recording_url,duration:e.duration_seconds,completed_at:e.completed_at}))}),e.on("quality_changed",e=>{e.wedding_id===n&&(console.log("\uD83D\uDCCA Quality changed:",e.quality),y({quality:e.quality,changed_by:e.changed_by,timestamp:e.timestamp}),setTimeout(()=>y(null),5e3))}),e.on("photo_uploaded",e=>{e.wedding_id===n&&(console.log("\uD83D\uDCF8 New media uploaded:",e),v(e),setTimeout(()=>v(null),3e3))}),e.on("camera_switched",e=>{console.log("\uD83C\uDFA5 Camera switched:",e)}),()=>{e&&(console.log("\uD83D\uDD0C Disconnecting socket"),e.emit("leave_wedding",{wedding_id:n}),e.disconnect())}},[n]);let N={socket:o.current,isConnected:c,viewerCount:m,messages:g,reactions:x,recordingStatus:h,qualityChanged:w,newMedia:j,sendMessage:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Anonymous";o.current&&c&&o.current.emit("send_message",{wedding_id:n,message:e,guest_name:t,timestamp:new Date().toISOString()})},sendReaction:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Anonymous";o.current&&c&&o.current.emit("send_reaction",{wedding_id:n,emoji:e,guest_name:t,timestamp:new Date().toISOString()})},switchCamera:e=>{o.current&&c&&o.current.emit("camera_switch",{wedding_id:n,camera_id:e})},updateQuality:e=>{o.current&&c&&o.current.emit("stream_quality_update",{wedding_id:n,quality:{level:e}})}};return(0,s.jsx)(i.Provider,{value:N,children:t})}function d(){return(0,r.useContext)(i)||{socket:null,isConnected:!1,viewerCount:0,messages:[],reactions:[],recordingStatus:null,qualityChanged:null,newMedia:null,sendMessage:()=>{},sendReaction:()=>{},switchCamera:()=>{},updateQuality:()=>{}}}}}]);